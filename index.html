<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surya Namaskar - Sun Salutation App</title>

       <!-- PWA Meta Tags (Replaces manifest.json link) -->
       <meta name="application-name" content="Surya Namaskar App">
       <meta name="description" content="Guided practice and guide for Surya Namaskar (Sun Salutation).">
       <meta name="mobile-web-app-capable" content="yes">
       <meta name="apple-mobile-web-app-capable"="yes">
       <meta name="apple-mobile-web-app-status-bar-style"="black"> <!-- Changed to black for seamless look -->
       <meta name="apple-mobile-web-app-title" content="SuryaNamaskar">
       <meta name="theme-color" content="#f97316"> <!-- Orange-500 -->
       <link rel="icon" type="image/png" sizes="192x192" href="icon.png"> <!-- Standard icon -->
       <link rel="apple-touch-icon" href="icon.png"> <!-- iOS icon -->
       <!-- You can add more icon sizes if needed -->
       <link rel="manifest" href="manifest.json">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Dark mode variables */
        :root {
            --bg-primary: #f9fafb;
            --bg-secondary: #ffffff;
            --bg-accent: #f3f4f6;
            --text-primary: #1f2937;
            --text-secondary: #4b5563;
            --accent-color: #f97316;
            --accent-hover: #ea580c;
            --border-color: #e5e7eb;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }
        
        /* Dark mode theme */
        [data-theme="dark"] {
            --bg-primary: #111827;
            --bg-secondary: #1f2937; /* Dark gray-blue */
            --bg-accent: #374151;  /* Medium gray-blue */
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --accent-color: #f97316;
            --accent-hover: #fb923c;
            --border-color: #4b5563; /* Slightly lighter border */
            --shadow-color: rgba(0, 0, 0, 0.5);

            /* Explicitly override common light background classes */
            .bg-white,
            .bg-gray-50,
            .bg-gray-100,
            .bg-gray-200 {
                background-color: var(--bg-secondary) !important;
            }
            .bg-orange-50,
            .bg-orange-100 {
                 /* Use a transparent orange for accents */
                background-color: rgba(249, 115, 22, 0.1) !important;
            }
             .bg-blue-50 {
                background-color: rgba(30, 58, 138, 0.2) !important; /* Darker blue */
            }
        }
        
        /* Fix for mobile dark text colors */
        [data-theme="dark"] .text-gray-600,
        [data-theme="dark"] .text-gray-700,
        [data-theme="dark"] .text-gray-800 {
            color: #e5e7eb !important;
        }
        
        [data-theme="dark"] .text-orange-600,
        [data-theme="dark"] .text-orange-700,
        [data-theme="dark"] .text-orange-800 {
            color: #fdba74 !important;
        }
        
        /* Fix for mobile dark text colors */
        [data-theme="dark"] .text-gray-600,
        [data-theme="dark"] .text-gray-700,
        [data-theme="dark"] .text-gray-800 {
            color: #e5e7eb !important;
        }
        
        [data-theme="dark"] .text-orange-600,
        [data-theme="dark"] .text-orange-700,
        [data-theme="dark"] .text-orange-800 {
            color: #fdba74 !important;
        }
        
        /* Apply theme variables */
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* Special text formatting consistent across light and dark modes */
        #guided-practice #special-instruction-container {
            background-color: #ea580c !important; /* Dark orange (orange-600) */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.75rem 1rem !important;
            margin: 0.75rem 0 !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
            border: none !important;
        }

        #guided-practice #special-instruction-text {
            font-weight: 700 !important; /* Bold */
            color: white !important; /* White text */
            text-align: center !important;
            font-size: 1.125rem !important; /* text-lg */
            letter-spacing: 0.05em !important; /* tracking-wide */
            text-transform: uppercase !important;
        }

        /* Force special instruction colors in both themes with maximum specificity */
        body[data-theme="light"] #guided-practice #special-instruction-container,
        body[data-theme="dark"] #guided-practice #special-instruction-container {
            background-color: #ea580c !important; /* Dark orange (orange-600) */
            color: white !important;
        }

        body[data-theme="light"] #guided-practice #special-instruction-text,
        body[data-theme="dark"] #guided-practice #special-instruction-text {
            color: white !important;
        }

        /* Ensure tab button text uses default contrast color in light mode */
        body[data-theme='light'] .tab-btn,
        body[data-theme='light'] .tab-btn i,
        body[data-theme='light'] .tab-btn span {
            color: #1f2937 !important; /* Force dark text/icon color in light mode */
        }
        
        /* Apply background colors to relevant elements, excluding card-specific ones */
        /* NOTE: .pose-card removed from this rule to allow its gradient background */
        /* NOTE: Removed .bg-gray-50, .bg-gray-100 to prevent override */
        .bg-white, 
        .max-w-md, header + div,
        .rounded-lg, .shadow, .shadow-lg {
            background-color: var(--bg-secondary); /* Removed !important */
            transition: background-color 0.3s ease;
            border-color: var(--border-color);
        }
        
        /* Fix blue info boxes in dark mode */
        [data-theme="dark"] .bg-blue-50 {
            background-color: rgba(30, 58, 138, 0.3) !important; /* dark blue */
        }
        
        [data-theme="dark"] .text-blue-700,
        [data-theme="dark"] .text-blue-800 {
            color: #93c5fd !important; /* lighter blue for dark mode */
        }
        
        /* Fix text colors for better readability in dark mode */
        .text-gray-800, .text-gray-700, .text-gray-600 {
            color: var(--text-primary);
            transition: color 0.3s ease;
        }
        
        .text-gray-500 {
            color: var(--text-secondary);
            transition: color 0.3s ease;
        }
        
        /* Ensure dark mode has white text for better contrast */
        [data-theme="dark"] .text-gray-800, 
        [data-theme="dark"] .text-gray-700, 
        [data-theme="dark"] .text-gray-600 {
            color: #f3f4f6 !important; /* Light gray, almost white */
        }
        
        [data-theme="dark"] .text-gray-500 {
            color: #d1d5db !important; /* Lighter gray */
        }
        
        /* Fix borders in dark mode */
        [data-theme="dark"] .border,
        [data-theme="dark"] .border-b,
        [data-theme="dark"] .border-t,
        [data-theme="dark"] .border-l,
        [data-theme="dark"] .border-r {
            border-color: var(--border-color);
        }
        
        /* Navigation header styles */
        header.bg-gradient-to-r {
            background-color: white;
        }
        
        [data-theme="dark"] header.bg-gradient-to-r {
            background-color: #1f2937 !important;
        }
        
        /* Navigation header styles */
        header {
            background-color: white;
        }
        
        [data-theme="dark"] header {
            background-color: #1f2937 !important;
        }
        
        /* Header styles */
        header.compact-header {
            padding: 0.5rem !important;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        header.compact-header h1 {
            font-size: 1.25rem !important;
            margin: 0;
        }
        
        /* Hide header subtitle on compact mode */
        header.compact-header p {
            display: none;
        }
        
        /* Tab content styles */
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        
        /* Pose image styles - INCREASED HEIGHT for mobile */
        .pose-image {
            transition: transform 0.3s ease;
            max-height: 280px; /* Increased from 220px for better mobile viewing */
            height: auto; /* Allow natural aspect ratio */
            object-fit: cover;
            width: 100%;
            display: block; /* Ensure it takes full width */
        }
        .pose-image:hover {
            transform: scale(1.05);
        }
        
        /* Progress bar */
        .progress-bar {
            height: 6px;
            transition: width 0.5s linear;
        }
        
        /* Pose cards */
        .current-pose-card {
            transform: scale(1.02);
            box-shadow: 0 10px 15px -3px rgba(249, 115, 22, 0.2), 0 4px 6px -2px rgba(249, 115, 22, 0.1);
            border: 1px solid var(--accent-color);
            background-color: var(--bg-secondary) !important;
        }
        
        /* Force white background for cards in light mode */
        body[data-theme='light'] .pose-card {
            background-color: white;
        }
       
/* Ensure pose card text is black in light mode */
body[data-theme='light'] .pose-card .text-gray-600,
body[data-theme='light'] .pose-card .text-gray-500,
body[data-theme='light'] .pose-card .text-gray-700,
body[data-theme='light'] .pose-card .text-gray-800 {
    color: #1f2937 !important; /* Black for readability */
}

/* Ensure breathing card background is light orange in light mode */
body[data-theme='light'] .pose-card .bg-orange-50 {
    background-color: #fff7ed !important; /* Tailwind orange-50 */
    color: #b45309 !important; /* Dark orange text for contrast */
}
body[data-theme='light'] .pose-card .bg-orange-100 {
    background-color: #ffedd5 !important; /* Tailwind orange-100 */
    color: #b45309 !important;
}


        .next-pose-card {
            opacity: 0.8;
        }
        
        /* Video container */
        #videoContainer {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
        }
        #videoContainer iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        /* Range input styling */
        input[type=range] {
            height: 6px;
            cursor: pointer;
            appearance: none;
            width: 100%;
            background: var(--border-color);
            border-radius: 9999px;
            outline: none;
        }
        input[type=range]::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            background: var(--accent-color);
            cursor: pointer;
            border-radius: 50%;
        }
        input[type=range]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: var(--accent-color);
            cursor: pointer;
            border-radius: 50%;
            border: none;
        }
        
        /* Image container styles */
        .pose-image-container {
            min-height: 280px; /* Match max-height of image - INCREASED */
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border-radius: 0.5rem;
            background-color: var(--bg-accent);
        }
        
        /* Dark mode toggle */
        .theme-toggle {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px var(--shadow-color);
            transition: all 0.3s ease;
            color: var(--text-primary);
            margin-left: auto;
        }
        
        .theme-toggle:hover {
            transform: scale(1.1);
            background-color: var(--accent-color);
            color: white;
        }
        
        [data-theme="dark"] .theme-toggle {
            background-color: var(--bg-accent);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
        }
        
        [data-theme="dark"] .theme-toggle:hover {
            background-color: var(--accent-color);
        }
        
        /* Video link styles */
        .video-link {
            display: block;
            padding: 12px;
            border-radius: 8px;
            background-color: var(--bg-accent);
            color: var(--text-primary);
            text-decoration: none;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }
        
        .video-link:hover {
            background-color: var(--accent-color);
            color: white;
        }
        
        /* Additional dark mode specific styles */
        [data-theme="dark"] #app-container {
            background-color: var(--bg-secondary);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        [data-theme="dark"] .pose-card {
            background-color: var(--bg-secondary) !important;
        }
        
        [data-theme="dark"] .pose-image-container {
            background-color: rgba(0, 0, 0, 0.2);
        }
        
        /* Dark mode styles for practice page */
        [data-theme="dark"] .current-pose-card {
            background-color: var(--bg-secondary) !important;
            border: 1px solid var(--accent-color);
        }
        
        [data-theme="dark"] .next-pose-card {
            background-color: var(--bg-accent) !important;
            opacity: 0.8;
        }
        
        [data-theme="dark"] .bg-orange-100 {
            background-color: rgba(249, 115, 22, 0.2) !important;
        }
        
        [data-theme="dark"] #current-pose-instruction,
        [data-theme="dark"] #next-pose-instruction {
            color: #e5e7eb !important;
        }
        
        [data-theme="dark"] #current-breathing-cue {
            color: #fdba74 !important; /* Light orange */
        }
        
        [data-theme="dark"] .tab-btn {
            color: var(--text-secondary);
        }
        
        [data-theme="dark"] .tab-btn.text-orange-600 {
            color: var(--accent-color) !important;
        }

        /* Restore tab button text color in dark mode (overrides the light mode !important) */
        [data-theme="dark"] .tab-btn,
        [data-theme="dark"] .tab-btn i,
        [data-theme="dark"] .tab-btn span {
            color: var(--text-secondary) !important; /* Use secondary text color for dark mode */
        }

        /* Fix dropdown background in dark mode */
        [data-theme="dark"] #timing select#rounds-select {
            background-color: var(--bg-secondary); /* Use secondary background for contrast */
            color: var(--text-primary); /* Use primary text color */
            border-color: var(--border-color); /* Match other dark mode borders */
        }
        
        [data-theme="dark"] input[type=range] {
            background-color: var(--bg-accent);
        }
        
        [data-theme="dark"] .video-link {
            background-color: var(--bg-accent);
        }
        
        [data-theme="dark"] .video-link:hover {
            background-color: var(--accent-color);
        }
        
        /* Practice controls layout - more compact */
        .practice-controls {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 0.5rem;
    background-color: #fff !important; /* Force white background in all cases */
    /* Remove any background-image or gradient if present */
    background-image: none !important;
    box-shadow: none !important;
    border: none !important;
}

[data-theme="light"] .practice-controls {
    background-color: #fff !important; /* White for light theme */
    background-image: none !important;
    box-shadow: none !important;
    border: none !important;
}

[data-theme="dark"] .practice-controls {
    background-color: #1f2937 !important; /* Keep dark for dark theme */
    background-image: none !important;
    box-shadow: none !important;
    border: none !important;
}
        
        .practice-controls button {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: all 0.3s ease;
        }
        
        .practice-controls .timer-container {
            text-align: center;
            padding: 0 0.25rem;
        }
        
        /* Media queries for responsive design */
        @media (max-width: 640px) {
            .pose-image {
                max-height: 250px; /* Slightly smaller on very small screens */
            }
            .pose-image-container {
                min-height: 250px;
            }
        }

        /* Add position relative to header to contain the absolute positioned toggle */
        header {
            position: relative;
        }

        body[data-theme='light'] .pose-card .text-gray-800,
body[data-theme='light'] .pose-card .text-gray-700,
body[data-theme='light'] .pose-card .text-gray-600,
body[data-theme='light'] .pose-card .text-gray-500 {
    color: #1f2937 !important;
}

/* Ensure Practice Page cards have light solid background in light mode */
body[data-theme='light'] #guided-practice .current-pose-card,
body[data-theme='light'] #guided-practice .next-pose-card {
    background-color: white !important; /* Use white or var(--bg-secondary) */
    background-image: none !important; /* Remove any gradients */
    border-color: var(--border-color);
}

body[data-theme='light'] #guided-practice .next-pose-card {
    opacity: 1; /* Ensure full opacity in light mode if needed */

    color: #1f2937 !important;
}

/* Ensure inner content area of practice cards is light in light mode */
body[data-theme='light'] #guided-practice .current-pose-card > div,
body[data-theme='light'] #guided-practice .next-pose-card > div {
    background-color: transparent !important; /* Make inner divs transparent so card bg shows */
}

/* Ensure text color is correct within practice cards in light mode */
body[data-theme='light'] #guided-practice .current-pose-card p,
body[data-theme='light'] #guided-practice .next-pose-card p {
     color: var(--text-primary) !important; /* Use primary text color for light mode */
}
body[data-theme='light'] #guided-practice .current-pose-card #current-breathing-cue {
     color: var(--accent-color) !important; /* Use accent color for breathing cue */
}

/* Ensure pose instruction text is black/dark gray in light mode */
body[data-theme='light'] #guided-practice .current-pose-card #current-pose-instruction {
     color: #1f2937 !important; /* Force black/dark gray */
}

/* Fix text colors for timer container in light mode */
[data-theme="light"] .practice-controls .timer-container .text-gray-600,
[data-theme="light"] #guided-practice .next-pose-card .text-gray-700,
[data-theme="light"] #guided-practice .next-pose-card .text-gray-600,
[data-theme="light"] #round-count,
[data-theme="light"] #total-rounds-display {
    color: #1f2937 !important; /* Force black text in light mode */
}

[data-theme="light"] .timer-container {
    color: #1f2937 !important;
}

[data-theme="light"] #next-pose-name,
[data-theme="light"] #next-pose-instruction {
    color: #1f2937 !important;
}

/* Ensure text in next pose breathing instruction is readable in light mode */
body[data-theme='light'] #guided-practice .next-pose-card .text-xs.text-gray-600.font-medium {
    color: #1f2937 !important; /* Dark text */
}

body[data-theme='light'] #guided-practice .next-pose-card .bg-white {
    background-color: #f3f4f6 !important; /* Light gray background */
}

/* Compact Practice Tab Styles */
        #guided-practice .p-4, 
        #guided-practice .p-3, 
        #guided-practice .p-2 {
            padding: 0.5rem !important; /* Reduce padding */
        }
        #guided-practice .mb-4, 
        #guided-practice .mb-3, 
        #guided-practice .mb-2 {
            margin-bottom: 0.5rem !important; /* Reduce margin */
        }
        #guided-practice .space-y-4 > :not([hidden]) ~ :not([hidden]) {
             --tw-space-y-reverse: 0;
             margin-top: calc(0.5rem * calc(1 - var(--tw-space-y-reverse))) !important; /* Reduce space-y-4 */
             margin-bottom: calc(0.5rem * var(--tw-space-y-reverse)) !important;
        }
        /* Reduce padding/margin specifically on the cards */
        #guided-practice .current-pose-card,
        #guided-practice .next-pose-card {
             padding: 0.5rem !important; /* Reduce card internal padding */
             margin-bottom: 0.5rem !important; /* Reduce space below cards */
        }
        /* Reduce padding on inner elements if necessary */
        #guided-practice .current-pose-card > div,
        #guided-practice .next-pose-card > div {
             padding: 0.25rem !important; /* Reduce padding inside card sections */
        }
        #guided-practice .practice-controls {
            padding: 0.25rem !important; /* Reduce padding on controls */
            margin-bottom: 0.5rem !important; /* Reduce margin below controls */
        }

/* Style for 'Swipe to explore' text container in light mode */
body[data-theme='light'] #guide .bg-blue-50 {
    background-color: #eff6ff !important; /* Tailwind blue-50 */
    color: #1d4ed8 !important; /* Tailwind blue-700 */
}

/* Reduce padding/margin specifically on the Guide page cards */
#guide .pose-card {
    padding: 0.5rem !important; /* Reduce card internal padding */
    margin-bottom: 0.5rem !important; /* Reduce space below cards */
}
#guide .p-4 {
    padding: 0.5rem !important;
}
#guide .mb-4 {
    margin-bottom: 0.5rem !important;
}
#guide .space-y-2 > :not([hidden]) ~ :not([hidden]) {
    --tw-space-y-reverse: 0;
    margin-top: calc(0.25rem * calc(1 - var(--tw-space-y-reverse))) !important; /* Reduce space-y-2 */
    margin-bottom: calc(0.25rem * var(--tw-space-y-reverse)) !important;
}

/* No footer styles needed */
    </style>
</head>
<body class="bg-gray-50 font-sans" data-theme="light">
    <div class="max-w-md mx-auto shadow-lg rounded-b-xl overflow-hidden mb-10" id="app-container">
        <!-- Navigation Header -->
        <div class="flex border-b bg-white dark:bg-gray-800 p-2 text-center relative overflow-hidden shadow-lg rounded-t-lg" style="background-color: white ;">
            
            <button class="tab-btn flex-1 py-2 px-2 text-center font-medium text-gray-700 dark:text-gray-200 border-b-2 border-transparent hover:border-orange-500 dark:hover:border-orange-400 transition-all duration-300 flex flex-col items-center" data-tab="pose-guide">
                <i class="fas fa-book-open text-lg text-gray-700 dark:text-gray-200"></i><span class="text-xs sm:text-sm">Guide</span>
            </button>
            <button class="tab-btn flex-1 py-2 px-2 text-center font-medium text-gray-700 dark:text-gray-200 border-b-2 border-transparent hover:border-orange-500 dark:hover:border-orange-400 transition-all duration-300 flex flex-col items-center" data-tab="guided-practice">
                <i class="fas fa-play-circle text-lg text-gray-700 dark:text-gray-200"></i><span class="text-xs sm:text-sm">Practice</span>
            </button>
            <button class="tab-btn flex-1 py-2 px-2 text-center font-medium text-gray-700 dark:text-gray-200 border-b-2 border-transparent hover:border-orange-500 dark:hover:border-orange-400 transition-all duration-300 flex flex-col items-center" data-tab="timing">
                <i class="fas fa-clock text-lg text-gray-700 dark:text-gray-200"></i><span class="text-xs sm:text-sm">Timing</span>
            </button>
            <button class="tab-btn flex-1 py-2 px-2 text-center font-medium text-gray-700 dark:text-gray-200 border-b-2 border-transparent hover:border-orange-500 dark:hover:border-orange-400 transition-all duration-300 flex flex-col items-center" data-tab="video">
                <i class="fas fa-video text-lg text-gray-700 dark:text-gray-200"></i><span class="text-xs sm:text-sm">Video</span>
            </button>
            <button class="tab-btn flex-1 py-2 px-2 text-center font-medium text-gray-700 dark:text-gray-200 border-b-2 border-transparent hover:border-orange-500 dark:hover:border-orange-400 transition-all duration-300 flex flex-col items-center" data-tab="stats">
                <i class="fas fa-chart-bar text-lg text-gray-700 dark:text-gray-200"></i><span class="text-xs sm:text-sm">Stats</span>
            </button>
        </div>



        <!-- Tab Contents -->
        <div class="p-4">
            <!-- Pose Guide Tab -->
            <div id="pose-guide" class="tab-content active">
                <div class="flex items-center justify-between mb-5">
                    <h2 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-orange-500 to-yellow-600">12 Steps of Surya Namaskar</h2>
                    <div class="text-xs text-gray-500 bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full">
                        <i class="fas fa-info-circle mr-1"></i> Swipe to explore
                    </div>
                </div>

                <div class="space-y-5">
                    <!-- Pose 1: Pranamasana -->
                    <div class="bg-white dark:bg-gray-700 p-4 rounded-xl shadow-md pose-card border border-gray-100 dark:border-gray-600 transition-all duration-300 hover:shadow-lg transform hover:scale-[1.01]">
                        <div class="flex items-center mb-3">
                            <div class="bg-gradient-to-br from-orange-100 to-yellow-100 dark:from-orange-500 dark:to-orange-600 dark:bg-opacity-30 text-orange-800 dark:text-orange-100 rounded-full w-9 h-9 flex items-center justify-center font-bold mr-3 flex-shrink-0 shadow-sm">1</div>
                            <h3 class="text-md font-semibold text-gray-800 dark:text-gray-100">Pranamasana <span class="text-sm text-gray-500 dark:text-gray-400">(Prayer Pose)</span></h3>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <div class="sm:w-1/3 flex-shrink-0 pose-image-container rounded-lg overflow-hidden shadow-sm"> 
                                <img src="assets/Surya-Namaskar-step-1.jpg" alt="Pranamasana" class="pose-image"> 
                            </div>
                            <div class="sm:w-2/3">
                                <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">Stand erect, feet together. Join palms at chest center. Relax, focus inwards.</p>
                                <div class="mt-2 text-sm bg-orange-50 dark:bg-gray-600 p-2 rounded-lg inline-flex items-center">
                                    <i class="fas fa-wind mr-2 text-orange-500"></i>
                                    <span class="font-medium text-orange-700 dark:text-orange-300">Breathing:</span> 
                                    <span class="ml-1 text-orange-600 dark:text-orange-200">Normal or Exhale</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pose 2: Hasta Uttanasana -->
                    <div class="bg-white dark:bg-gray-700 p-4 rounded-xl shadow-md pose-card border border-gray-100 dark:border-gray-600 transition-all duration-300 hover:shadow-lg transform hover:scale-[1.01]">
                        <div class="flex items-center mb-3">
                            <div class="bg-gradient-to-br from-orange-100 to-yellow-100 dark:from-orange-500 dark:to-orange-600 dark:bg-opacity-30 text-orange-800 dark:text-orange-100 rounded-full w-9 h-9 flex items-center justify-center font-bold mr-3 flex-shrink-0 shadow-sm">2</div>
                            <h3 class="text-md font-semibold text-gray-800 dark:text-gray-100">Hasta Uttanasana <span class="text-sm text-gray-500 dark:text-gray-400">(Raised Arms)</span></h3>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <div class="sm:w-1/3 flex-shrink-0 pose-image-container rounded-lg overflow-hidden shadow-sm"> 
                                <img src="assets/Surya-Namaskar-step-2.jpg" alt="Hasta Uttanasana" class="pose-image">
                            </div>
                            <div class="sm:w-2/3">
                                <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">Raise arms overhead, arch back gently from upper back, push hips slightly forward. Keep arms beside ears.</p>
                                <div class="mt-2 text-sm bg-orange-50 dark:bg-gray-600 p-2 rounded-lg inline-flex items-center">
                                    <i class="fas fa-wind mr-2 text-orange-500"></i>
                                    <span class="font-medium text-orange-700 dark:text-orange-300">Breathing:</span> 
                                    <span class="ml-1 text-orange-600 dark:text-orange-200">Inhale</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pose 3: Hasta Padasana -->
                    <div class="bg-white dark:bg-gray-700 p-4 rounded-xl shadow-md pose-card border border-gray-100 dark:border-gray-600 transition-all duration-300 hover:shadow-lg transform hover:scale-[1.01]">
                        <div class="flex items-center mb-3">
                            <div class="bg-gradient-to-br from-orange-100 to-yellow-100 dark:from-orange-500 dark:to-orange-600 dark:bg-opacity-30 text-orange-800 dark:text-orange-100 rounded-full w-9 h-9 flex items-center justify-center font-bold mr-3 flex-shrink-0 shadow-sm">3</div>
                            <h3 class="text-md font-semibold text-gray-800 dark:text-gray-100">Hasta Padasana <span class="text-sm text-gray-500 dark:text-gray-400">(Hand to Foot)</span></h3>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <div class="sm:w-1/3 flex-shrink-0 pose-image-container rounded-lg overflow-hidden shadow-sm"> 
                                <img src="assets/Surya-Namaskar-step-3.jpg" alt="Hasta Padasana" class="pose-image">
                            </div>
                            <div class="sm:w-2/3">
                                <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">Bend forward from hips, spine straight. Bring hands down beside feet. Try to touch forehead to knees (bend knees if needed).</p>
                                <div class="mt-2 text-sm bg-orange-50 dark:bg-gray-600 p-2 rounded-lg inline-flex items-center">
                                    <i class="fas fa-wind mr-2 text-orange-500"></i>
                                    <span class="font-medium text-orange-700 dark:text-orange-300">Breathing:</span> 
                                    <span class="ml-1 text-orange-600 dark:text-orange-200">Exhale</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pose 4: Ashwa Sanchalanasana -->
                    <div class="bg-white dark:bg-gray-700 p-4 rounded-xl shadow-md pose-card border border-gray-100 dark:border-gray-600 transition-all duration-300 hover:shadow-lg transform hover:scale-[1.01]">
                         <div class="flex items-center mb-3">
                            <div class="bg-gradient-to-br from-orange-100 to-yellow-100 dark:from-orange-500 dark:to-orange-600 dark:bg-opacity-30 text-orange-800 dark:text-orange-100 rounded-full w-9 h-9 flex items-center justify-center font-bold mr-3 flex-shrink-0 shadow-sm">4</div>
                            <h3 class="text-md font-semibold text-gray-800 dark:text-gray-100">Ashwa Sanchalanasana <span class="text-sm text-gray-500 dark:text-gray-400">(Equestrian)</span></h3>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <div class="sm:w-1/3 flex-shrink-0 pose-image-container rounded-lg overflow-hidden shadow-sm"> 
                                <img src="assets/Surya-Namaskar-step-4.jpg" alt="Ashwa Sanchalanasana" class="pose-image">
                            </div>
                            <div class="sm:w-2/3">
                                <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">Stretch right leg back, knee on floor. Left knee between hands, bent at 90°. Look up, arch spine slightly.</p>
                                <div class="mt-2 text-sm bg-orange-50 dark:bg-gray-600 p-2 rounded-lg inline-flex items-center">
                                    <i class="fas fa-wind mr-2 text-orange-500"></i>
                                    <span class="font-medium text-orange-700 dark:text-orange-300">Breathing:</span> 
                                    <span class="ml-1 text-orange-600 dark:text-orange-200">Inhale</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pose 5: Parvatasana -->
                    <div class="bg-white dark:bg-gray-700 p-4 rounded-xl shadow-md pose-card border border-gray-100 dark:border-gray-600 transition-all duration-300 hover:shadow-lg transform hover:scale-[1.01]">
                         <div class="flex items-center mb-3">
                            <div class="bg-gradient-to-br from-orange-100 to-yellow-100 dark:from-orange-500 dark:to-orange-600 dark:bg-opacity-30 text-orange-800 dark:text-orange-100 rounded-full w-9 h-9 flex items-center justify-center font-bold mr-3 flex-shrink-0 shadow-sm">5</div>
                            <h3 class="text-md font-semibold text-gray-800 dark:text-gray-100">Parvatasana <span class="text-sm text-gray-500 dark:text-gray-400">(Mountain)</span></h3>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <div class="sm:w-1/3 flex-shrink-0 pose-image-container rounded-lg overflow-hidden shadow-sm"> 
                                <img src="assets/Surya-Namaskar-step-5.jpg" alt="Parvatasana" class="pose-image">
                            </div>
                            <div class="sm:w-2/3">
                                <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">Bring left leg back beside right. Lift hips up, push heels towards floor (inverted V). Head between arms.</p>
                                <div class="mt-2 text-sm bg-orange-50 dark:bg-gray-600 p-2 rounded-lg inline-flex items-center">
                                    <i class="fas fa-wind mr-2 text-orange-500"></i>
                                    <span class="font-medium text-orange-700 dark:text-orange-300">Breathing:</span> 
                                    <span class="ml-1 text-orange-600 dark:text-orange-200">Exhale</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pose 6: Ashtanga Namaskara -->
                    <div class="bg-white dark:bg-gray-700 p-4 rounded-xl shadow-md pose-card border border-gray-100 dark:border-gray-600 transition-all duration-300 hover:shadow-lg transform hover:scale-[1.01]">
                         <div class="flex items-center mb-3">
                            <div class="bg-gradient-to-br from-orange-100 to-yellow-100 dark:from-orange-500 dark:to-orange-600 dark:bg-opacity-30 text-orange-800 dark:text-orange-100 rounded-full w-9 h-9 flex items-center justify-center font-bold mr-3 flex-shrink-0 shadow-sm">6</div>
                            <h3 class="text-md font-semibold text-gray-800 dark:text-gray-100">Ashtanga Namaskara <span class="text-sm text-gray-500 dark:text-gray-400">(Eight Limbs)</span></h3>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <div class="sm:w-1/3 flex-shrink-0 pose-image-container rounded-lg overflow-hidden shadow-sm"> 
                                <img src="assets/Surya-Namaskar-step-6.jpg" alt="Ashtanga Namaskara" class="pose-image">
                            </div>
                            <div class="sm:w-2/3">
                                <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">Lower knees, chest, and chin to floor. Hips remain slightly elevated. Eight points touch: feet, knees, hands, chest, chin.</p>
                                <div class="mt-2 text-sm bg-orange-50 dark:bg-gray-600 p-2 rounded-lg inline-flex items-center">
                                    <i class="fas fa-wind mr-2 text-orange-500"></i>
                                    <span class="font-medium text-orange-700 dark:text-orange-300">Breathing:</span> 
                                    <span class="ml-1 text-orange-600 dark:text-orange-200">Hold breath</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pose 7: Bhujangasana -->
                    <div class="bg-white dark:bg-gray-700 p-4 rounded-xl shadow-md pose-card border border-gray-100 dark:border-gray-600 transition-all duration-300 hover:shadow-lg transform hover:scale-[1.01]">
                         <div class="flex items-center mb-3">
                            <div class="bg-gradient-to-br from-orange-100 to-yellow-100 dark:from-orange-500 dark:to-orange-600 dark:bg-opacity-30 text-orange-800 dark:text-orange-100 rounded-full w-9 h-9 flex items-center justify-center font-bold mr-3 flex-shrink-0 shadow-sm">7</div>
                            <h3 class="text-md font-semibold text-gray-800 dark:text-gray-100">Bhujangasana <span class="text-sm text-gray-500 dark:text-gray-400">(Cobra)</span></h3>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <div class="sm:w-1/3 flex-shrink-0 pose-image-container rounded-lg overflow-hidden shadow-sm"> 
                                <img src="assets/Surya-Namaskar-step-7.jpg" alt="Bhujangasana" class="pose-image">
                            </div>
                            <div class="sm:w-2/3">
                                <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">Slide forward, raise chest using back muscles (minimal hand pressure). Elbows bent, close to body. Look up.</p>
                                <div class="mt-2 text-sm bg-orange-50 dark:bg-gray-600 p-2 rounded-lg inline-flex items-center">
                                    <i class="fas fa-wind mr-2 text-orange-500"></i>
                                    <span class="font-medium text-orange-700 dark:text-orange-300">Breathing:</span> 
                                    <span class="ml-1 text-orange-600 dark:text-orange-200">Inhale</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pose 8: Parvatasana -->
                    <div class="bg-white dark:bg-gray-700 p-4 rounded-xl shadow-md pose-card border border-gray-100 dark:border-gray-600 transition-all duration-300 hover:shadow-lg transform hover:scale-[1.01]">
                         <div class="flex items-center mb-3">
                            <div class="bg-gradient-to-br from-orange-100 to-yellow-100 dark:from-orange-500 dark:to-orange-600 dark:bg-opacity-30 text-orange-800 dark:text-orange-100 rounded-full w-9 h-9 flex items-center justify-center font-bold mr-3 flex-shrink-0 shadow-sm">8</div>
                            <h3 class="text-md font-semibold text-gray-800 dark:text-gray-100">Parvatasana <span class="text-sm text-gray-500 dark:text-gray-400">(Mountain)</span></h3>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <div class="sm:w-1/3 flex-shrink-0 pose-image-container rounded-lg overflow-hidden shadow-sm"> 
                                <img src="assets/Surya-Namaskar-step-5.jpg" alt="Parvatasana" class="pose-image">
                            </div>
                             <div class="sm:w-2/3">
                                <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">Lift hips up, push heels towards floor (inverted V). Head between arms. Same as Pose 5.</p>
                                <div class="mt-2 text-sm bg-orange-50 dark:bg-gray-600 p-2 rounded-lg inline-flex items-center">
                                    <i class="fas fa-wind mr-2 text-orange-500"></i>
                                    <span class="font-medium text-orange-700 dark:text-orange-300">Breathing:</span> 
                                    <span class="ml-1 text-orange-600 dark:text-orange-200">Exhale</span>
                                </div>
                            </div>
                        </div>
                    </div>

                     <!-- Pose 9: Ashwa Sanchalanasana -->
                    <div class="bg-white dark:bg-gray-700 p-4 rounded-xl shadow-md pose-card border border-gray-100 dark:border-gray-600 transition-all duration-300 hover:shadow-lg transform hover:scale-[1.01]">
                         <div class="flex items-center mb-3">
                            <div class="bg-gradient-to-br from-orange-100 to-yellow-100 dark:from-orange-500 dark:to-orange-600 dark:bg-opacity-30 text-orange-800 dark:text-orange-100 rounded-full w-9 h-9 flex items-center justify-center font-bold mr-3 flex-shrink-0 shadow-sm">9</div>
                            <h3 class="text-md font-semibold text-gray-800 dark:text-gray-100">Ashwa Sanchalanasana <span class="text-sm text-gray-500 dark:text-gray-400">(Equestrian)</span></h3>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <div class="sm:w-1/3 flex-shrink-0 pose-image-container rounded-lg overflow-hidden shadow-sm"> 
                                <img src="assets/Surya-Namaskar-step-9.jpg" alt="Ashwa Sanchalanasana" class="pose-image">
                            </div>
                            <div class="sm:w-2/3">
                                <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">Bring right foot forward between hands. Left knee on floor. Look up. Same as Pose 4, leading with the opposite leg.</p>
                                <div class="mt-2 text-sm bg-orange-50 dark:bg-gray-600 p-2 rounded-lg inline-flex items-center">
                                    <i class="fas fa-wind mr-2 text-orange-500"></i>
                                    <span class="font-medium text-orange-700 dark:text-orange-300">Breathing:</span> 
                                    <span class="ml-1 text-orange-600 dark:text-orange-200">Inhale</span>
                                </div>
                            </div>
                        </div>
                    </div>

                     <!-- Pose 10: Hasta Padasana -->
                    <div class="bg-white dark:bg-gray-700 p-4 rounded-xl shadow-md pose-card border border-gray-100 dark:border-gray-600 transition-all duration-300 hover:shadow-lg transform hover:scale-[1.01]">
                         <div class="flex items-center mb-3">
                            <div class="bg-gradient-to-br from-orange-100 to-yellow-100 dark:from-orange-500 dark:to-orange-600 dark:bg-opacity-30 text-orange-800 dark:text-orange-100 rounded-full w-9 h-9 flex items-center justify-center font-bold mr-3 flex-shrink-0 shadow-sm">10</div>
                            <h3 class="text-md font-semibold text-gray-800 dark:text-gray-100">Hasta Padasana <span class="text-sm text-gray-500 dark:text-gray-400">(Hand to Foot)</span></h3>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <div class="sm:w-1/3 flex-shrink-0 pose-image-container rounded-lg overflow-hidden shadow-sm"> 
                                <img src="assets/Surya-Namaskar-step-3.jpg" alt="Hasta Padasana" class="pose-image">
                            </div>
                           <div class="sm:w-2/3">
                                <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">Bring left foot forward next to right. Bend forward from hips. Same as Pose 3.</p>
                                <div class="mt-2 text-sm bg-orange-50 dark:bg-gray-600 p-2 rounded-lg inline-flex items-center">
                                    <i class="fas fa-wind mr-2 text-orange-500"></i>
                                    <span class="font-medium text-orange-700 dark:text-orange-300">Breathing:</span> 
                                    <span class="ml-1 text-orange-600 dark:text-orange-200">Exhale</span>
                                </div>
                            </div>
                        </div>
                    </div>

                     <!-- Pose 11: Hasta Uttanasana -->
                    <div class="bg-white dark:bg-gray-700 p-4 rounded-xl shadow-md pose-card border border-gray-100 dark:border-gray-600 transition-all duration-300 hover:shadow-lg transform hover:scale-[1.01]">
                         <div class="flex items-center mb-3">
                            <div class="bg-gradient-to-br from-orange-100 to-yellow-100 dark:from-orange-500 dark:to-orange-600 dark:bg-opacity-30 text-orange-800 dark:text-orange-100 rounded-full w-9 h-9 flex items-center justify-center font-bold mr-3 flex-shrink-0 shadow-sm">11</div>
                            <h3 class="text-md font-semibold text-gray-800 dark:text-gray-100">Hasta Uttanasana <span class="text-sm text-gray-500 dark:text-gray-400">(Raised Arms)</span></h3>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <div class="sm:w-1/3 flex-shrink-0 pose-image-container rounded-lg overflow-hidden shadow-sm"> 
                                <img src="assets/Surya-Namaskar-step-2.jpg" alt="Hasta Uttanasana" class="pose-image">
                            </div>
                             <div class="sm:w-2/3">
                                <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">Raise torso, lift arms overhead, arch back gently. Same as Pose 2.</p>
                                <div class="mt-2 text-sm bg-orange-50 dark:bg-gray-600 p-2 rounded-lg inline-flex items-center">
                                    <i class="fas fa-wind mr-2 text-orange-500"></i>
                                    <span class="font-medium text-orange-700 dark:text-orange-300">Breathing:</span> 
                                    <span class="ml-1 text-orange-600 dark:text-orange-200">Inhale</span>
                                </div>
                            </div>
                        </div>
                    </div>

                     <!-- Pose 12: Pranamasana -->
                    <div class="bg-white dark:bg-gray-700 p-4 rounded-xl shadow-md pose-card border border-gray-100 dark:border-gray-600 transition-all duration-300 hover:shadow-lg transform hover:scale-[1.01]">
                         <div class="flex items-center mb-3">
                            <div class="bg-gradient-to-br from-orange-100 to-yellow-100 dark:from-orange-500 dark:to-orange-600 dark:bg-opacity-30 text-orange-800 dark:text-orange-100 rounded-full w-9 h-9 flex items-center justify-center font-bold mr-3 flex-shrink-0 shadow-sm">12</div>
                            <h3 class="text-md font-semibold text-gray-800 dark:text-gray-100">Pranamasana <span class="text-sm text-gray-500 dark:text-gray-400">(Prayer Pose)</span></h3>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <div class="sm:w-1/3 flex-shrink-0 pose-image-container rounded-lg overflow-hidden shadow-sm"> 
                                <img src="assets/Surya-Namaskar-step-1.jpg" alt="Pranamasana" class="pose-image">
                            </div>
                             <div class="sm:w-2/3">
                                <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">Bring arms down, join palms at chest center. Return to starting position. Same as Pose 1.</p>
                                <div class="mt-2 text-sm bg-orange-50 dark:bg-gray-600 p-2 rounded-lg inline-flex items-center">
                                    <i class="fas fa-wind mr-2 text-orange-500"></i>
                                    <span class="font-medium text-orange-700 dark:text-orange-300">Breathing:</span> 
                                    <span class="ml-1 text-orange-600 dark:text-orange-200">Exhale
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Guided Practice Tab -->
            <div id="guided-practice" class="tab-content">
                <div class="practice-controls bg-orange-50 dark:bg-gray-800 p-2 rounded-xl shadow-md mb-3">
                    <button id="play-pause-btn" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white transition duration-300 shadow-lg transform hover:scale-105 active:scale-95">
                        <i class="fas fa-play" id="play-pause-icon"></i>
                    </button>
                    
                    <div class="timer-container mx-1">
                        <div class="text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-orange-500 to-orange-600 mb-1" id="timer">05</div>
                        <div class="text-xs text-gray-600 dark:text-gray-300 mb-1 font-medium">Time Remaining in Pose</div>
                        <div class="text-xs text-gray-600 dark:text-gray-300">Round: <span id="round-count" class="font-medium text-orange-600 dark:text-orange-400">1</span>/<span id="total-rounds-display" class="font-medium">5</span></div>
                        <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-3 mt-2 shadow-inner">
                            <div class="progress-bar bg-orange-500 h-3 rounded-full shadow-sm" style="width: 100%" id="pose-progress"></div>
                        </div>
                    </div>
                    
                    <button id="reset-btn" class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white transition duration-300 shadow-lg transform hover:scale-105 active:scale-95">
                        <i class="fas fa-redo"></i>
                    </button>
                </div>

                <!-- Compact Practice UI with Current Pose Prominence -->
                <div class="mb-3">
                    <!-- Current Pose - Compact but still prominent -->
                    <div class="bg-orange-50 dark:bg-gray-800 p-3 rounded-2xl shadow-xl current-pose-card mb-3 transform transition-all duration-300 border border-orange-100 dark:border-gray-600">
                        <div class="flex justify-between items-center mb-1">
                            <div class="bg-orange-100 dark:bg-gray-600 px-3 py-1 rounded-full">
                                <h3 class="text-sm font-medium text-orange-700 dark:text-orange-300">Pose <span id="current-pose-number" class="font-bold">1</span>/12</h3>
                            </div>
                            <h2 class="text-xl font-bold text-orange-600 dark:text-orange-400" id="current-pose-name">Pranamasana</h2>
                        </div>
                        
                        <div class="pose-image-container mb-2 rounded-xl overflow-hidden shadow-md" style="min-height: 300px;"> 
                            <img src="assets/Surya-Namaskar-step-1.jpg" alt="Current Pose" class="pose-image" id="current-pose-image" style="max-height: 300px;">
                        </div>
                        
                        <!-- Special instruction container for all poses -->
                        <div id="special-instruction-container" class="hidden mb-3">
                            <h3 id="special-instruction-text"></h3>
                        </div>
                        
                        <div class="bg-orange-100 dark:bg-gray-700 p-2 rounded-xl shadow-inner">
                            <div class="text-sm text-gray-700 dark:text-gray-200 mb-2 leading-relaxed" id="current-pose-instruction">Stand erect...</div>
                            
                            <div class="flex items-center text-sm text-orange-700 dark:text-orange-300 font-medium bg-white dark:bg-gray-800 p-1 rounded-lg shadow-sm">
                                <i class="fas fa-wind mr-2 text-orange-500"></i> Breathing: <span id="current-breathing-cue" class="ml-1">Exhale / Normal</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Next Pose - Compact version -->
                    <div class="bg-gray-50 dark:bg-gray-700 p-2 rounded-xl shadow-md next-pose-card border border-gray-200 dark:border-gray-500 transition-all duration-300">
                        <div class="flex justify-between items-center mb-1">
                            <div class="bg-gray-200 dark:bg-gray-500 px-2 py-0.5 rounded-full">
                                <h3 class="text-xs font-medium text-gray-600 dark:text-gray-200">Next <span id="next-pose-number" class="font-bold">2</span>/12</h3>
                            </div>
                            <h2 class="text-md font-bold text-gray-700 dark:text-gray-200" id="next-pose-name">Hasta Uttanasana</h2>
                        </div>
                        
                        <div class="flex items-center gap-2">
                            <div class="w-1/3 pose-image-container rounded-lg overflow-hidden shadow-sm" style="min-height: 100px;"> 
                                <img src="assets/Surya-Namaskar-step-2.jpg" alt="Next Pose" class="pose-image" id="next-pose-image" style="max-height: 100px;">
                            </div>
                            
                            <div class="w-2/3">
                                <div class="text-xs text-gray-600 dark:text-gray-300 mb-1 leading-relaxed" id="next-pose-instruction">Raise both arms...</div>
                                
                                <div class="text-xs text-gray-600 dark:text-gray-300 font-medium bg-white dark:bg-gray-800 p-1 rounded-lg shadow-sm inline-flex items-center">
                                    <i class="fas fa-wind mr-1 text-gray-500 dark:text-gray-400"></i> Next: <span id="next-breathing-cue" class="ml-1">Inhale</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

               <!-- <div class="mt-3 bg-blue-50 p-2 rounded-lg">
                    <h3 class="font-medium text-blue-800 mb-1"><i class="fas fa-info-circle mr-1"></i>Practice Tips</h3>
                    <ul class="text-xs text-blue-700 space-y-0.5 list-disc list-inside">
                        <li>Focus on your breathing throughout the sequence.</li>
                        <li>Move smoothly between poses.</li>
                        <li>Modify poses as needed for your flexibility.</li>
                        <li>Keep your awareness on the present moment.</li>
                    </ul>
                </div>-->
            </div>

            <!-- Timing Tab -->
            <div id="timing" class="tab-content">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Customize Your Practice</h2>

                <div class="bg-gray-50 p-4 rounded-lg shadow mb-6">
                    <h3 class="font-medium text-gray-700 mb-3">Pose Duration (seconds per pose)</h3>
                    <div class="space-y-4">
                         <div id="pose-sliders-container"></div>
                    </div>
                </div>

                <div class="bg-gray-50 p-4 rounded-lg shadow mb-6">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-medium text-gray-700">Practice Settings</h3>
                        <!-- Dark Mode Toggle Button moved to Timing tab -->
                        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
                            <i id="theme-icon" class="fas fa-moon"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label for="rounds-select" class="block text-sm text-gray-600 mb-1">Number of Rounds</label>
                            <select id="rounds-select" class="w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500">
                                <option value="3">3</option>
                                <option value="5">5</option> <!-- Removed selected -->
                                <option value="10">10</option>
                                <option value="12">12</option>
                                <option value="24">24</option>
                                <option value="108">108</option> 
                            </select>
                        </div>

                        <div>
                            <label class="flex items-center">
                                <input type="checkbox" id="voice-guidance" class="rounded text-orange-500 focus:ring-orange-500"> 
                                <span class="ml-2 text-sm text-gray-600">Voice Guidance</span>
                            </label>
                        </div>
                        
                        <div>
                            <label class="flex items-center">
                                <input type="checkbox" id="breathing-cues" class="rounded text-orange-500 focus:ring-orange-500"> 
                                <span class="ml-2 text-sm text-gray-600">Breathing Cues</span>
                            </label>
                            <p class="text-xs text-gray-500 ml-6 mt-1">When enabled, plays "Inhale", "Exhale", "Hold" audio. When disabled, plays pose-specific instructions.</p>
                        </div>

                        <div>
                            <label class="flex items-center">
                                <input type="checkbox" id="transition-sounds" class="rounded text-orange-500 focus:ring-orange-500"> 
                                <span class="ml-2 text-sm text-gray-600">Transition Sounds</span>
                            </label>
                        </div>
                    </div>
                </div>

                <button id="save-settings-btn" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-medium py-3 px-6 rounded-full transition duration-300">
                    Save Settings
                </button>
                <p id="settings-saved-msg" class="text-center text-green-600 text-sm mt-2 h-4"></p>
            </div>

            <!-- Video Tab -->
            <div id="video" class="tab-content">
              
                <h2 class="text-xl font-bold text-gray-800 mb-4">Video Demonstrations</h2>
                
                <div class="space-y-4">
                    <!-- Video Link 1 -->
                    <a href="https://youtube.com/shorts/8XLBpKnWYww?si=Pjby9t87EGcPDD_G" target="_blank" rel="noopener" class="video-link">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 mr-3">
                                <i class="fas fa-play-circle text-2xl text-orange-500"></i>
                            </div>
                            <div>
                                <h3 class="font-medium mb-1">Quick Surya Namaskar Demo</h3>
                                <p class="text-sm opacity-80">Short demonstration of all 12 poses</p>
                                <div class="mt-1 text-xs opacity-70">
                                    <span><i class="fas fa-clock mr-1"></i> 1 min</span>
                                </div>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Video Link 2 -->
                    <a href="https://www.youtube.com/watch?v=8AakYeM23sI" target="_blank" rel="noopener" class="video-link">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 mr-3">
                                <i class="fas fa-play-circle text-2xl text-orange-500"></i>
                            </div>
                            <div>
                                <h3 class="font-medium mb-1">Guided Surya Namaskar Practice</h3>
                                <p class="text-sm opacity-80">Full guided session with proper breathing</p>
                                <div class="mt-1 text-xs opacity-70">
                                    <span><i class="fas fa-clock mr-1"></i> 10 min</span>
                                </div>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Video Link 3 -->
                    <a href="https://www.youtube.com/watch?v=gC_L9qAHVJ8" target="_blank" rel="noopener" class="video-link">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 mr-3">
                                <i class="fas fa-play-circle text-2xl text-orange-500"></i>
                            </div>
                            <div>
                                <h3 class="font-medium mb-1">Detailed Surya Namaskar Tutorial</h3>
                                <p class="text-sm opacity-80">Learn proper form and alignment for each pose</p>
                                <div class="mt-1 text-xs opacity-70">
                                    <span><i class="fas fa-clock mr-1"></i> 15 min</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                
                <div class="mt-3 bg-blue-50 p-2 rounded-lg">
                    <h3 class="font-medium text-blue-800 mb-2"><i class="fas fa-info-circle mr-2"></i>Video Tips</h3>
                    <ul class="text-xs text-blue-700 space-y-0.5 list-disc list-inside">
                        <li>Click any link to open the video in your browser</li>
                        <li>Videos will open in a new tab</li>
                        <li>Choose the video that matches your experience level</li>
                        <li>Practice along with the guided videos for best results</li>
                    </ul>
                </div>

                <div class="mt-4 text-center text-sm text-gray-600 dark:text-gray-300">
                    Made with <span class="text-red-500">💗</span> by <a href="mailto:tiwarinaren@gmail.com" class="text-orange-600 dark:text-orange-400 hover:text-orange-700 dark:hover:text-orange-300 transition-colors">Naren Tiwari</a>
                </div>
            </div>

            <!-- Stats Tab -->
            <div id="stats" class="tab-content">
                <!-- Today's Stats Card -->
                <div class="mb-6 p-5 rounded-xl shadow-lg bg-gradient-to-r from-orange-500 to-yellow-400 text-white">
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="text-xl font-bold">Today's Practice</h2>
                        <div id="today-date" class="text-sm bg-white/20 px-3 py-1 rounded-full">
                            <i class="fas fa-calendar-day mr-1"></i> <span id="current-date"></span>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-4xl font-bold" id="stat-today-rounds">0</div>
                        <div class="text-sm">Rounds Completed</div>
                    </div>
                    
                    <!-- Share Today's Stats -->
                    <div class="mt-4 flex gap-3">
                        <button id="share-stats-btn" class="flex-1 bg-white text-orange-600 hover:bg-orange-50 font-medium py-2 px-4 rounded-lg shadow transition flex items-center justify-center">
                            <i class="fas fa-share-alt mr-2"></i> Share Progress
                        </button>
                        <button id="mark-today-btn" class="bg-white text-orange-600 hover:bg-orange-50 font-medium py-2 px-4 rounded-lg shadow transition flex items-center justify-center">
                            <i class="fas fa-plus mr-2"></i> Add Round
                        </button>
                    </div>
                </div>
                
                <!-- Overall Stats Cards -->
                <div class="grid grid-cols-2 gap-3 mb-6">
                    <div class="rounded-xl shadow-md bg-white dark:bg-gray-800 p-4 flex flex-col items-center">
                        <div class="text-3xl mb-2"><i class="fas fa-sun text-orange-500"></i></div>
                        <div class="text-2xl font-bold text-gray-800 dark:text-white" id="stat-total-rounds">0</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400 mt-1">Total Rounds</div>
                    </div>
                    <div class="rounded-xl shadow-md bg-white dark:bg-gray-800 p-4 flex flex-col items-center">
                        <div class="text-3xl mb-2"><i class="fas fa-calendar-check text-orange-500"></i></div>
                        <div class="text-2xl font-bold text-gray-800 dark:text-white" id="stat-total-days">0</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400 mt-1">Practice Days</div>
                    </div>
                    <div class="rounded-xl shadow-md bg-white dark:bg-gray-800 p-4 flex flex-col items-center">
                        <div class="text-3xl mb-2"><i class="fas fa-fire text-orange-500"></i></div>
                        <div class="text-2xl font-bold text-gray-800 dark:text-white" id="stat-streak">0</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400 mt-1">Current Streak</div>
                    </div>
                    <div class="rounded-xl shadow-md bg-white dark:bg-gray-800 p-4 flex flex-col items-center">
                        <div class="text-3xl mb-2"><i class="fas fa-trophy text-yellow-500"></i></div>
                        <div class="text-2xl font-bold text-gray-800 dark:text-white" id="stat-best-streak">0</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400 mt-1">Best Streak</div>
                    </div>
                </div>
                
                <!-- Habit Tracker -->
                <div class="bg-white dark:bg-gray-800 p-5 rounded-xl shadow-md mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white">
                            <i class="fas fa-check-circle text-orange-500 mr-2"></i>Habit Tracker
                        </h3>
                        <button id="habit-plus-btn" class="bg-orange-500 hover:bg-orange-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-base shadow-md transition" title="Mark today as completed">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div id="habit-grid" class="grid grid-cols-7 gap-2 mb-3"></div>
                    <div class="text-xs text-gray-500 dark:text-gray-400 mt-2">Tap a day to mark/unmark as practiced.</div>
                </div>
                
                <!-- Motivation Message -->
                <div id="stats-motivation" class="text-center text-orange-600 dark:text-orange-400 font-semibold mt-4 p-3 bg-orange-50 dark:bg-gray-700 rounded-lg"></div>
                
                <!-- Share Stats Modal (hidden by default) -->
                <div id="share-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                    <div class="bg-white dark:bg-gray-800 p-5 rounded-xl shadow-lg max-w-md w-full mx-4">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white">Share Your Progress</h3>
                            <button id="close-share-modal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div id="share-card" class="bg-gradient-to-r from-orange-500 to-yellow-400 p-4 rounded-lg text-white mb-4">
                            <div class="text-center mb-3">
                                <h4 class="text-xl font-bold">My Surya Namaskar Practice</h4>
                                <p class="text-sm opacity-90" id="share-date"></p>
                            </div>
                            
                            <div class="flex justify-around mb-3">
                                <div class="text-center">
                                    <div class="text-3xl font-bold" id="share-today-rounds">0</div>
                                    <div class="text-xs">Today</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-3xl font-bold" id="share-total-rounds">0</div>
                                    <div class="text-xs">Total</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-3xl font-bold" id="share-streak">0</div>
                                    <div class="text-xs">Streak</div>
                                </div>
                            </div>
                            
                            <div class="text-center text-sm">
                                <p>Join me in practicing Surya Namaskar daily!</p>
                            </div>
                        </div>
                        
                        <div class="flex gap-2">
                            <button id="copy-stats-btn" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg shadow transition flex items-center justify-center">
                                <i class="fas fa-copy mr-2"></i> Copy Text
                            </button>
                            <button id="download-stats-btn" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg shadow transition flex items-center justify-center">
                                <i class="fas fa-download mr-2"></i> Save Image
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer removed as requested -->

    <!-- Hidden Audio Players with iOS Compatibility -->
<audio id="transition-sound" src="assets/soft_beep.mp3" preload="auto" playsinline></audio>
<audio id="inhale-sound" src="assets/inhale.mp3" preload="auto" playsinline></audio>
<audio id="exhale-sound" src="assets/exhale.mp3" preload="auto" playsinline></audio>
<audio id="hold-sound" src="assets/hold.mp3" preload="auto" playsinline></audio>
<audio id="left-leg-forward-sound" src="assets/left_leg_forward.mp3" preload="auto" playsinline></audio>
<audio id="right-leg-forward-sound" src="assets/right_leg_forward.mp3" preload="auto" playsinline></audio>

<!-- Special audio for all poses -->
<audio id="pose1-audio" src="assets/pose1_join_hands.mp3" preload="auto" playsinline></audio>
<audio id="pose2-audio" src="assets/pose2_raise_arms.mp3" preload="auto" playsinline></audio>
<audio id="pose3-audio" src="assets/pose3_forward_bend.mp3" preload="auto" playsinline></audio>
<audio id="pose5-audio" src="assets/pose5_mountain_pose.mp3" preload="auto" playsinline></audio>
<audio id="pose6-audio" src="assets/pose6_eight_limbs.mp3" preload="auto" playsinline></audio>
<audio id="pose7-audio" src="assets/pose7_cobra_pose.mp3" preload="auto" playsinline></audio>
<audio id="pose8-audio" src="assets/pose8_mountain_pose.mp3" preload="auto" playsinline></audio>
<audio id="pose10-audio" src="assets/pose10_forward_bend.mp3" preload="auto" playsinline></audio>
<audio id="pose11-audio" src="assets/pose11_raise_arms.mp3" preload="auto" playsinline></audio>
<audio id="pose12-audio" src="assets/pose12_return_to_center.mp3" preload="auto" playsinline></audio>

<script>
    // --- Pose Data ---
    const poses = [
        { name: "Pranamasana", image: "assets/Surya-Namaskar-step-1.jpg", instruction: "Stand erect, feet together. Join palms at chest center.", duration: 5, breathing: "Exhale / Normal", specialText: "JOIN HANDS", specialAudio: "pose1-audio" },
        { name: "Hasta Uttanasana", image: "assets/Surya-Namaskar-step-2.jpg", instruction: "Inhale, raise arms, arch back gently.", duration: 5, breathing: "Inhale", specialText: "RAISE ARMS", specialAudio: "pose2-audio" },
        { name: "Hasta Padasana", image: "assets/Surya-Namaskar-step-3.jpg", instruction: "Exhale, bend forward from hips, hands to feet.", duration: 5, breathing: "Exhale", specialText: "FORWARD BEND", specialAudio: "pose3-audio" },
        { name: "Ashwa Sanchalanasana", image: "assets/Surya-Namaskar-step-4.jpg", instruction: "Inhale, step right leg back, knee down, look up.", duration: 5, breathing: "Inhale", specialAudio: "left-leg-forward-sound", specialText: "LEFT LEG FORWARD" },
        { name: "Parvatasana", image: "assets/Surya-Namaskar-step-5.jpg", instruction: "Exhale, step left leg back, lift hips (inverted V).", duration: 5, breathing: "Exhale", specialText: "MOUNTAIN POSE", specialAudio: "pose5-audio" },
        { name: "Ashtanga Namaskara", image: "assets/Surya-Namaskar-step-6.jpg", instruction: "Hold breath, lower knees, chest, chin.", duration: 5, breathing: "Hold Breath", specialText: "EIGHT LIMBS", specialAudio: "pose6-audio" },
        { name: "Bhujangasana", image: "assets/Surya-Namaskar-step-7.jpg", instruction: "Inhale, slide forward, lift chest (cobra).", duration: 5, breathing: "Inhale", specialText: "COBRA POSE", specialAudio: "pose7-audio" },
        { name: "Parvatasana", image: "assets/Surya-Namaskar-step-5.jpg", instruction: "Exhale, lift hips back to inverted V.", duration: 5, breathing: "Exhale", specialText: "MOUNTAIN POSE", specialAudio: "pose8-audio" },
        { name: "Ashwa Sanchalanasana", image: "assets/Surya-Namaskar-step-9.jpg", instruction: "Inhale, step right foot forward, left knee down.", duration: 5, breathing: "Inhale", specialAudio: "right-leg-forward-sound", specialText: "RIGHT LEG FORWARD" },
        { name: "Hasta Padasana", image: "assets/Surya-Namaskar-step-3.jpg", instruction: "Exhale, step left foot forward, bend forward.", duration: 5, breathing: "Exhale", specialText: "FORWARD BEND", specialAudio: "pose10-audio" },
        { name: "Hasta Uttanasana", image: "assets/Surya-Namaskar-step-2.jpg", instruction: "Inhale, raise arms, arch back.", duration: 5, breathing: "Inhale", specialText: "RAISE ARMS", specialAudio: "pose11-audio" },
        { name: "Pranamasana", image: "assets/Surya-Namaskar-step-1.jpg", instruction: "Exhale, return to prayer pose.", duration: 5, breathing: "Exhale", specialText: "RETURN TO CENTER", specialAudio: "pose12-audio" },
    ];

    // Default Settings (will be overridden by localStorage if available)
    // Get initial durations FROM the poses array itself
    const defaultSettings = {
        poseDurations: poses.map(p => p.duration),
        totalRounds: 5,
        voiceGuidance: true,
        breathingCues: true,
        transitionSounds: true
    };

    // --- Global State ---
    let timerInterval = null;
    let poseTimeRemaining = 0;
    let isRunning = false;
    let currentPoseIndex = 0;
    let currentRound = 1;
    let totalRounds = defaultSettings.totalRounds;
    let voiceGuidanceEnabled = defaultSettings.voiceGuidance;
    let breathingCuesEnabled = defaultSettings.breathingCues;
    let transitionSoundsEnabled = defaultSettings.transitionSounds;
    const totalPoses = poses.length;
    const SETTINGS_KEY = 'suryaNamaskarSettings'; // Key for localStorage

    // --- DOM Elements ---
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    const timerDisplay = document.getElementById('timer');
    const playPauseBtn = document.getElementById('play-pause-btn');
    const playPauseIcon = document.getElementById('play-pause-icon');
    const resetBtn = document.getElementById('reset-btn');
    const roundCountDisplay = document.getElementById('round-count');
    const totalRoundsDisplay = document.getElementById('total-rounds-display');
    const progressBar = document.getElementById('pose-progress');
    const poseSlidersContainer = document.getElementById('pose-sliders-container');
    const roundsSelect = document.getElementById('rounds-select');
    const voiceGuidanceCheckbox = document.getElementById('voice-guidance');
    const transitionSoundsCheckbox = document.getElementById('transition-sounds');
    const saveSettingsBtn = document.getElementById('save-settings-btn');
    const settingsSavedMsg = document.getElementById('settings-saved-msg');

    // Guided Practice UI Elements
    const currentPoseNumberDisplay = document.getElementById('current-pose-number');
    const currentPoseNameDisplay = document.getElementById('current-pose-name');
    const currentPoseImage = document.getElementById('current-pose-image');
    const currentPoseInstruction = document.getElementById('current-pose-instruction');
    const currentBreathingCue = document.getElementById('current-breathing-cue');
    const nextPoseNumberDisplay = document.getElementById('next-pose-number');
    const nextPoseNameDisplay = document.getElementById('next-pose-name');
    const nextPoseImage = document.getElementById('next-pose-image');
    const nextPoseInstruction = document.getElementById('next-pose-instruction');
    const nextBreathingCue = document.getElementById('next-breathing-cue');

    // --- Audio Elements --- Get references
    const transitionSound = document.getElementById('transition-sound');
    const inhaleSound = document.getElementById('inhale-sound');
    const exhaleSound = document.getElementById('exhale-sound');
    const holdSound = document.getElementById('hold-sound');

    // --- Functions ---
    
    // Helper function to play sounds
    function playSound(audioElement) {
        if (!audioElement) return;
        
        // Reset the audio to the beginning
        audioElement.currentTime = 0;
        
        // Play the sound with error handling
        const playPromise = audioElement.play();
        
        if (playPromise !== undefined) {
            playPromise.catch(error => {
                console.error('Error playing sound:', error);
            });
        }
    }

    // PWA Service Worker Registration
    function registerServiceWorker() {
        if ('serviceWorker' in navigator) {
             // Make sure the path is correct relative to your HTML file's location
            navigator.serviceWorker.register('sw.js') // Use 'sw.js' if it's in the same directory
                .then(registration => {
                    console.log('Service Worker registered with scope:', registration.scope);
                })
                .catch(error => {
                    console.error('Service Worker registration failed:', error);
                });
        }
    }
    
    // Preload audio files for iOS compatibility
    function preloadAudioFiles() {
        // Get all audio elements
        const audioElements = [
            transitionSound,
            inhaleSound,
            exhaleSound,
            holdSound,
            document.getElementById('left-leg-forward-sound'),
            document.getElementById('right-leg-forward-sound'),
            document.getElementById('pose1-audio'),
            document.getElementById('pose2-audio'),
            document.getElementById('pose3-audio'),
            document.getElementById('pose5-audio'),
            document.getElementById('pose6-audio'),
            document.getElementById('pose7-audio'),
            document.getElementById('pose8-audio'),
            document.getElementById('pose10-audio'),
            document.getElementById('pose11-audio'),
            document.getElementById('pose12-audio')
        ];
        
        // Force load each audio file
        audioElements.forEach(audio => {
            // Create a temporary function to handle user interaction requirement on iOS
            const loadAudio = () => {
                // Load the audio file
                audio.load();
                
                // Set volume to 0 temporarily
                const originalVolume = audio.volume;
                audio.volume = 0;
                
                // Try to play and immediately pause to "unlock" audio on iOS
                audio.play().then(() => {
                    // Successfully played, now pause and restore volume
                    audio.pause();
                    audio.currentTime = 0;
                    audio.volume = originalVolume;
                    console.log(`Preloaded audio: ${audio.src.split('/').pop()}`);
                }).catch(error => {
                    // If it fails, that's okay - we'll try again when needed
                    console.log(`Could not preload audio: ${error.message}`);
                    audio.volume = originalVolume;
                });
            };
            
            // Call the function
            loadAudio();
        });
    }

    // Tab Switching
    function activateTab(tabId) {
        tabBtns.forEach(b => {
            const isCurrent = b.getAttribute('data-tab') === tabId;
            b.classList.toggle('text-orange-600', isCurrent);
            b.classList.toggle('border-orange-500', isCurrent);
            b.classList.toggle('text-gray-500', !isCurrent);
            b.classList.toggle('border-transparent', !isCurrent);
        });
        tabContents.forEach(content => {
            content.classList.toggle('active', content.id === tabId);
        });
    }

    // Timing Tab: Create/Update Sliders
    function initializeTimingSliders() {
        poseSlidersContainer.innerHTML = ''; // Clear existing
        // Use the current durations stored in the poses array
        poses.forEach((pose, index) => {
            const sliderId = `pose${index + 1}-time`;
            const valueId = `pose${index + 1}-value`;
            const div = document.createElement('div');
            div.classList.add('mb-3');
            div.innerHTML = `
                <label for="${sliderId}" class="block text-sm text-gray-600 mb-1">${index + 1}. ${pose.name}</label>
                <input type="range" min="2" max="30" value="${pose.duration}" class="w-full" id="${sliderId}" data-index="${index}">
                <div class="flex justify-between text-xs text-gray-500 mt-1 px-1">
                    <span>2s</span>
                    <span id="${valueId}" class="font-medium text-orange-600">${pose.duration}s</span>
                    <span>30s</span>
                </div>
            `;
            poseSlidersContainer.appendChild(div);

            const slider = document.getElementById(sliderId);
            const valueDisplay = document.getElementById(valueId);
            slider.addEventListener('input', () => {
                valueDisplay.textContent = `${slider.value}s`;
                valueDisplay.classList.add('text-orange-600');
            });
        });
    }

    // --- Settings Load/Save ---
    function loadSettings() {
         const savedSettings = localStorage.getItem(SETTINGS_KEY);
         let settings;
         let loadedDurations = null;

         if (savedSettings) {
             try {
                settings = JSON.parse(savedSettings);
                // Validate loaded settings structure
                if (settings && settings.poseDurations && settings.poseDurations.length === totalPoses) {
                    loadedDurations = settings.poseDurations;
                } else {
                    console.warn("Invalid settings format in localStorage, using defaults.");
                    settings = null; // Force using defaults below
                    localStorage.removeItem(SETTINGS_KEY);
                }
             } catch (e) {
                 console.error("Error parsing settings from localStorage, using defaults:", e);
                 settings = null;
                 localStorage.removeItem(SETTINGS_KEY);
             }
         }

         // Use loaded settings or defaults
         const finalSettings = settings || { ...defaultSettings, poseDurations: poses.map(p => p.duration) }; // Ensure fresh default durations if needed

         // Apply settings to the main 'poses' array and global vars
         poses.forEach((pose, index) => {
             // Validate duration: must be between 2 and 30
             const loadedDuration = parseInt(finalSettings.poseDurations[index], 10);
             pose.duration = Math.max(2, Math.min(30, isNaN(loadedDuration) ? 5 : loadedDuration)); // Fallback to 5 if NaN
         });
         totalRounds = finalSettings.totalRounds || defaultSettings.totalRounds;
         voiceGuidanceEnabled = finalSettings.voiceGuidance !== undefined ? finalSettings.voiceGuidance : defaultSettings.voiceGuidance;
         breathingCuesEnabled = finalSettings.breathingCues !== undefined ? finalSettings.breathingCues : defaultSettings.breathingCues;
         transitionSoundsEnabled = finalSettings.transitionSounds !== undefined ? finalSettings.transitionSounds : defaultSettings.transitionSounds;

         // Update UI elements in Timing Tab to reflect loaded/default state
         roundsSelect.value = totalRounds;
         voiceGuidanceCheckbox.checked = voiceGuidanceEnabled;
         document.getElementById('breathing-cues').checked = breathingCuesEnabled;
         transitionSoundsCheckbox.checked = transitionSoundsEnabled;

         // Update UI elements in Practice Tab
         totalRoundsDisplay.textContent = totalRounds;

         // Re-initialize sliders AFTER updating pose durations
         initializeTimingSliders();

         console.log("Settings Applied:", { poseDurations: poses.map(p=>p.duration), totalRounds, voiceGuidanceEnabled, transitionSoundsEnabled });
    }

    function saveSettings() {
        const currentDurations = [];
        poses.forEach((_, index) => {
            const slider = document.getElementById(`pose${index + 1}-time`);
            // Read directly from slider, validate, and update the main poses array
            const duration = Math.max(2, Math.min(30, slider ? parseInt(slider.value, 10) : 5)); // Use 5 as fallback if slider not found
            poses[index].duration = duration;
            currentDurations.push(duration);
        });

        const selectedRounds = parseInt(roundsSelect.value, 10);
        const voiceChecked = voiceGuidanceCheckbox.checked;
        const breathingChecked = document.getElementById('breathing-cues').checked;
        const soundsChecked = transitionSoundsCheckbox.checked;

        const settingsToSave = {
            poseDurations: currentDurations, // Save the validated durations
            totalRounds: selectedRounds,
            voiceGuidance: voiceChecked,
            breathingCues: breathingChecked,
            transitionSounds: soundsChecked
        };

        try {
            localStorage.setItem(SETTINGS_KEY, JSON.stringify(settingsToSave));
            console.log("Settings Saved:", settingsToSave);

            // Update global state variables used by practice tab
            totalRounds = selectedRounds;
            voiceGuidanceEnabled = voiceChecked;
            breathingCuesEnabled = breathingChecked;
            transitionSoundsEnabled = soundsChecked;

            // Update UI in Practice Tab immediately
            totalRoundsDisplay.textContent = totalRounds;

            resetPractice(); // Reset practice state to reflect new settings

            settingsSavedMsg.textContent = 'Settings Saved!';
            setTimeout(() => { settingsSavedMsg.textContent = ''; }, 2000);

        } catch (e) {
            console.error("Error saving settings to localStorage:", e);
            settingsSavedMsg.textContent = 'Error saving settings!';
            setTimeout(() => { settingsSavedMsg.textContent = ''; }, 3000);
        }
    }

    // --- Enhanced Audio Playback Function for iOS Compatibility ---
    function playSound(audioElement) {
        if (!audioElement) return;
        
        // Reset audio element
        audioElement.pause();
        audioElement.currentTime = 0;
        
        // Create a user interaction promise for iOS
        const playPromise = audioElement.play();
        
        // Handle play() promise to catch errors properly
        if (playPromise !== undefined) {
            playPromise
                .then(() => {
                    // Playback started successfully
                    console.log(`Playing sound: ${audioElement.src.split('/').pop()}`);
                })
                .catch(error => {
                    // Auto-play was prevented or other error
                    console.error("Audio play failed:", error);
                    
                    // For iOS, try playing again with a slight delay
                    setTimeout(() => {
                        audioElement.play()
                            .catch(retryError => console.error("Retry audio play failed:", retryError));
                    }, 100);
                });
        }
    }

    // --- Play Breathing Cue (Fixed) ---
    function playBreathingCue(poseIndex) {
        if (!voiceGuidanceEnabled) return; // Only play if voice guidance is enabled
        
        // Check if breathing cues are enabled
        if (!breathingCuesEnabled) {
            // If breathing cues are disabled, play the special audio instead
            playSpecialAudio(poseIndex);
            return;
        }
        
        // Force a small delay to ensure audio context is ready
        setTimeout(() => {
            const poseData = poses[poseIndex];
            const breathingCue = poseData?.breathing?.toLowerCase() || '';
            console.log(`Playing breathing cue for pose ${poseIndex + 1}: ${breathingCue}`);
            
            // Make sure audio elements are properly loaded
            inhaleSound.load();
            exhaleSound.load();
            holdSound.load();
            
            // Play breathing cue immediately
            playBreathingSound(breathingCue);
        }, 100); // Small delay to ensure audio context is ready
    }
    
    // Function to play special audio for a pose
    function playSpecialAudio(poseIndex) {
        const poseData = poses[poseIndex];
        if (poseData && poseData.specialAudio) {
            const specialAudio = document.getElementById(poseData.specialAudio);
            if (specialAudio) {
                console.log(`Playing special audio for pose ${poseIndex + 1}: ${poseData.specialText}`);
                specialAudio.load();
                playSound(specialAudio);
            }
        }
    }
    
    // Helper function to play the appropriate breathing sound
    function playBreathingSound(breathingCue) {
        if (breathingCue.includes('inhale')) {
            console.log('Playing inhale sound');
            playSound(inhaleSound);
        } else if (breathingCue.includes('exhale')) {
            console.log('Playing exhale sound');
            playSound(exhaleSound);
        } else if (breathingCue.includes('hold')) {
            console.log('Playing hold sound');
            playSound(holdSound);
        } else {
            console.log('No matching breathing cue found');
        }
    }

    // --- Smoother Visual Transitions for Practice Tab ---
    function fadeTransition(element, newSrc, callback) {
        element.style.transition = 'opacity 0.4s';
        element.style.opacity = 0;
        setTimeout(() => {
            if (newSrc) element.src = newSrc;
            element.style.opacity = 1;
            if (callback) setTimeout(callback, 400);
        }, 400);
    }

    // Guided Practice: Update Pose Display
    function updatePoseDisplay(isInitial = false) {
        const currentPoseData = poses[currentPoseIndex];
        const nextPoseIndex = (currentPoseIndex + 1) % totalPoses;
        const nextPoseData = poses[nextPoseIndex];

        // Fade transition for current pose image
        fadeTransition(currentPoseImage, currentPoseData.image);
        // Fade transition for next pose image
        fadeTransition(nextPoseImage, nextPoseData.image);
        
        // Handle special instructions for all poses
        const specialInstructionContainer = document.getElementById('special-instruction-container');
        const specialInstructionText = document.getElementById('special-instruction-text');
        
        // All poses now have special text
        // Update the special instruction text
        specialInstructionText.textContent = currentPoseData.specialText;
        // Show the special instruction container
        specialInstructionContainer.classList.remove('hidden');
        
        // We don't need to play special audio here anymore as it's handled in the playBreathingCue function
        // This ensures that either breathing cues or special audio is played based on settings

        // Current Pose
        currentPoseNumberDisplay.textContent = currentPoseIndex + 1;
        currentPoseNameDisplay.textContent = currentPoseData.name;
        currentPoseInstruction.textContent = currentPoseData.instruction;
        currentBreathingCue.textContent = currentPoseData.breathing;

        // Next Pose
        nextPoseNumberDisplay.textContent = nextPoseIndex + 1;
        nextPoseNameDisplay.textContent = nextPoseData.name;
        nextPoseInstruction.textContent = nextPoseData.instruction;
        nextBreathingCue.textContent = nextPoseData.breathing;

        // Update timer display and progress bar
        poseTimeRemaining = currentPoseData.duration;
        timerDisplay.textContent = poseTimeRemaining.toString().padStart(2, '0');
        progressBar.style.width = '100%';

        // Update round display
        roundCountDisplay.textContent = currentRound;
    }

    // Guided Practice: Timer Tick
    function timerTick() {
         if (!isRunning) return;

        poseTimeRemaining--;
        timerDisplay.textContent = poseTimeRemaining.toString().padStart(2, '0');

        // Update progress bar using the correct duration from the poses array
         // *** FIX: Use the duration directly from the updated poses array ***
        const currentPoseDuration = poses[currentPoseIndex].duration; // Should be valid (>=2)
        const progressPercent = Math.max(0, (poseTimeRemaining / currentPoseDuration) * 100);
        progressBar.style.width = `${progressPercent}%`;

        // Check if pose duration reached
        if (poseTimeRemaining <= 0) {
            moveToNextPose();
        }
    }

    // Track completed rounds during practice
    let completedRounds = 0;
    
    // Function to update completed rounds counter
    function updateCompletedRounds() {
        // Increment completed rounds
        completedRounds++;
        
        // Update the stats immediately
        const stats = loadStats();
        stats.totalRounds = (stats.totalRounds || 0) + 1;
        
        // Update today's rounds
        const today = getTodayStr();
        stats.days[today] = true;
        if (!stats.todayRounds) stats.todayRounds = {};
        stats.todayRounds[today] = (stats.todayRounds[today] || 0) + 1;
        
        // Update streaks
        let streak = 0;
        let d = new Date();
        while (stats.days[getTodayStrFromDate(d)]) {
            streak++;
            d.setDate(d.getDate()-1);
        }
        if (!stats.bestStreak || streak > stats.bestStreak) stats.bestStreak = streak;
        
        // Save stats
        saveStats(stats);
        
        // Show a small notification
        const notification = document.createElement('div');
        notification.className = 'fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-4 py-2 rounded-full shadow-lg z-50';
        notification.innerHTML = `<i class="fas fa-check-circle mr-2"></i> Round ${completedRounds} completed!`;
        document.body.appendChild(notification);
        
        // Remove notification after 3 seconds
        setTimeout(() => {
            notification.style.opacity = '0';
            notification.style.transition = 'opacity 0.5s ease';
            setTimeout(() => notification.remove(), 500);
        }, 3000);
    }
    
    // Guided Practice: Move to Next Pose (Enhanced for consistent audio)
    function moveToNextPoseWithStats() {
        // Play transition sound BEFORE updating the index if enabled
        if (transitionSoundsEnabled) {
            playSound(transitionSound);
        }

        // Small delay to ensure transition sound completes before voice guidance
        setTimeout(() => {
            currentPoseIndex++;
            if (currentPoseIndex >= totalPoses) {
                // Completed a full round
                updateCompletedRounds();
                
                currentPoseIndex = 0; // Wrap around poses
                currentRound++;
                if (currentRound > totalRounds) {
                    // Create a more engaging completion message
                    const completionMessage = `
                        <div class="text-center p-4">
                            <div class="text-3xl mb-3">🎉 Practice Complete! 🎉</div>
                            <div class="text-xl mb-4">You finished ${totalRounds} rounds of Surya Namaskar.</div>
                            <div class="text-sm text-gray-600">Your progress has been saved.</div>
                        </div>
                    `;
                    
                    // Show a modal or alert with the completion message
                    alert(`Practice Complete! You finished ${totalRounds} rounds.`);
                    
                    // Reset practice
                    resetPractice();
                    return; // Stop the timer loop
                } else {
                    if (voiceGuidanceEnabled) console.log(`Starting Round ${currentRound}`);
                }
            }

            // Update display for the NEW pose
            updatePoseDisplay();

            // Play breathing cue for the NEW pose AFTER display update with a slight delay
            // This ensures the audio context has time to reset between sounds
            setTimeout(() => {
                if (voiceGuidanceEnabled) {
                    console.log(`Playing breathing cue for pose ${currentPoseIndex + 1} (${poses[currentPoseIndex].name})`);
                    playBreathingCue(currentPoseIndex);
                }
            }, 300);

            // Reset the timer interval for the new pose's duration
            clearInterval(timerInterval); // Clear old interval
            if (isRunning) { // Start new interval only if still running
                timerInterval = setInterval(timerTick, 1000);
            }
        }, 200); // Small delay to separate transition sound from voice guidance
    }

    // Guided Practice: Toggle Play/Pause
    function togglePlayPause() {
        isRunning = !isRunning;
        if (!isRunning) {
            // Pause
            clearInterval(timerInterval);
            timerInterval = null;
            playPauseBtn.classList.remove('bg-yellow-500', 'hover:bg-yellow-600');
            playPauseBtn.classList.add('bg-green-500', 'hover:bg-green-600');
            playPauseIcon.classList.remove('fa-pause');
            playPauseIcon.classList.add('fa-play');
            resetBtn.disabled = false;
            resetBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        } else {
            // Play
            playPauseBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
            playPauseBtn.classList.add('bg-yellow-500', 'hover:bg-yellow-600');
            playPauseIcon.classList.remove('fa-play');
            playPauseIcon.classList.add('fa-pause');
            resetBtn.disabled = true;
            resetBtn.classList.add('opacity-50', 'cursor-not-allowed');

            // Get current pose duration
            const currentPoseDuration = poses[currentPoseIndex].duration;
            // If resuming, keep current time; otherwise, set to full duration
            if (!(poseTimeRemaining > 0 && poseTimeRemaining < currentPoseDuration)) {
                poseTimeRemaining = currentPoseDuration;
            }

            timerDisplay.textContent = poseTimeRemaining.toString().padStart(2, '0');
            const progressPercent = Math.max(0, (poseTimeRemaining / currentPoseDuration) * 100);
            progressBar.style.width = `${progressPercent}%`;

            // Play breathing cue for the first pose when starting
            if (currentPoseIndex === 0 && poseTimeRemaining === currentPoseDuration) {
                if (voiceGuidanceEnabled) console.log(`Starting Round ${currentRound}: ${poses[currentPoseIndex].name}`);
                playBreathingCue(currentPoseIndex);
            } else if (voiceGuidanceEnabled) {
                console.log(`Resuming: ${poses[currentPoseIndex].name}`);
            }

            // Start the countdown
            clearInterval(timerInterval);
            timerInterval = setInterval(timerTick, 1000);
        }
    }

    // Reset Practice
    function resetPractice() {
        isRunning = false;
        clearInterval(timerInterval);
        timerInterval = null;
        currentPoseIndex = 0;
        currentRound = 1;
        updatePoseDisplay(true);
        // Reset button styles
        playPauseBtn.classList.remove('bg-yellow-500', 'hover:bg-yellow-600');
        playPauseBtn.classList.add('bg-green-500', 'hover:bg-green-600');
        playPauseIcon.classList.remove('fa-pause');
        playPauseIcon.classList.add('fa-play');
        resetBtn.disabled = false;
        resetBtn.classList.remove('opacity-50', 'cursor-not-allowed');
    }

    // --- Enhanced Dark Mode Toggle Function ---
    function toggleDarkMode() {
        const body = document.body;
        const themeIcon = document.getElementById('theme-icon');
        const appContainer = document.getElementById('app-container');
        const currentTheme = body.getAttribute('data-theme');
        
        // Apply theme to body and app container
        if (currentTheme === 'light') {
            // Switch to dark mode
            body.setAttribute('data-theme', 'dark');
            themeIcon.classList.remove('fa-moon');
            themeIcon.classList.add('fa-sun');
            localStorage.setItem('theme', 'dark');
            
            // Force refresh all pose cards
            document.querySelectorAll('.pose-card').forEach(card => {
                card.style.backgroundColor = 'var(--bg-accent)';
            });
            
            // Ensure app container has proper background
            appContainer.style.backgroundColor = 'var(--bg-secondary)';
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if (!btn.classList.contains('text-orange-600')) {
                    btn.style.color = 'var(--text-secondary)';
                }
            });
        } else {
            // Switch to light mode
            body.setAttribute('data-theme', 'light');
            themeIcon.classList.remove('fa-sun');
            themeIcon.classList.add('fa-moon');
            localStorage.setItem('theme', 'light');
            
            // Force refresh all pose cards
            document.querySelectorAll('.pose-card').forEach(card => {
                card.style.backgroundColor = 'var(--bg-secondary)';
            });
            
            // Ensure app container has proper background
            appContainer.style.backgroundColor = 'var(--bg-secondary)';
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if (!btn.classList.contains('text-orange-600')) {
                    btn.style.color = '';
                }
            });
        }
        
        // Force redraw of all elements with transition
        document.querySelectorAll('.pose-image-container, .video-link, .rounded-lg').forEach(el => {
            el.style.transition = 'none';
            el.offsetHeight; // Trigger reflow
            el.style.transition = '';
        });
    }
    
    // --- Enhanced Load Theme Preference ---
    function loadThemePreference() {
        const savedTheme = localStorage.getItem('theme');
        const themeIcon = document.getElementById('theme-icon');
        const appContainer = document.getElementById('app-container');
        
        // Apply the saved theme or default to light
        if (savedTheme === 'dark') {
            // Apply dark theme
            document.body.setAttribute('data-theme', 'dark');
            themeIcon.classList.remove('fa-moon');
            themeIcon.classList.add('fa-sun');
            
            // Apply dark mode to specific elements
            setTimeout(() => {
                // Use setTimeout to ensure DOM is fully loaded
                document.querySelectorAll('.pose-card').forEach(card => {
                    card.style.backgroundColor = 'var(--bg-accent)';
                });
                
                if (appContainer) {
                    appContainer.style.backgroundColor = 'var(--bg-secondary)';
                }
                
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    if (!btn.classList.contains('text-orange-600')) {
                        btn.style.color = 'var(--text-secondary)';
                    }
                });
                
                // Apply dark mode to blue info boxes
                document.querySelectorAll('.bg-blue-50').forEach(box => {
                    box.style.backgroundColor = 'rgba(30, 58, 138, 0.3)';
                });
                
                document.querySelectorAll('.text-blue-700, .text-blue-800').forEach(text => {
                    text.style.color = '#93c5fd';
                });
            }, 0);
        } else {
            // Apply light theme
            document.body.setAttribute('data-theme', 'light');
            themeIcon.classList.remove('fa-sun');
            themeIcon.classList.add('fa-moon');
        }
    }

    // --- Speed Presets for Timing Tab ---
    function addSpeedPresets() {
        const container = document.createElement('div');
        container.className = 'flex gap-2 mb-4';
        const presets = [
            { name: 'Beginner', values: [8,8,8,8,8,8,8,8,8,8,8,8] },
            { name: 'Intermediate', values: [5,5,5,5,5,5,5,5,5,5,5,5] },
            { name: 'Advanced', values: [3,3,3,3,3,3,3,3,3,3,3,3] }
        ];
        presets.forEach(preset => {
            const btn = document.createElement('button');
            btn.textContent = preset.name;
            btn.className = 'flex-1 bg-orange-100 hover:bg-orange-200 text-orange-700 font-semibold py-2 rounded transition';
            btn.addEventListener('click', () => {
                poses.forEach((pose, i) => {
                    pose.duration = preset.values[i];
                    const slider = document.getElementById(`pose${i+1}-time`);
                    const value = document.getElementById(`pose${i+1}-value`);
                    if (slider && value) {
                        slider.value = preset.values[i];
                        value.textContent = `${preset.values[i]}s`;
                    }
                });
            });
            container.appendChild(btn);
        });
        poseSlidersContainer.parentNode.insertBefore(container, poseSlidersContainer);
    }

    // --- Stats & Progress Tracking ---
    const STATS_KEY = 'suryaNamaskarStats';

    function getTodayStr() {
        const d = new Date();
        return d.toISOString().slice(0,10); // YYYY-MM-DD
    }

    function loadStats() {
        let stats = localStorage.getItem(STATS_KEY);
        if (stats) {
            try { stats = JSON.parse(stats); } catch { stats = null; }
        }
        if (!stats || typeof stats !== 'object') {
            stats = { totalRounds: 0, days: {}, bestStreak: 0 };
        }
        return stats;
    }

    function saveStats(stats) {
        localStorage.setItem(STATS_KEY, JSON.stringify(stats));
    }

    function updateStatsUI() {
        const stats = loadStats();
        // Total rounds
        document.getElementById('stat-total-rounds').textContent = stats.totalRounds || 0;
        // Days practiced
        const days = Object.keys(stats.days || {});
        document.getElementById('stat-total-days').textContent = days.length;
        // Streaks
        let streak = 0, best = stats.bestStreak || 0;
        let today = new Date();
        let d = new Date(today);
        while (stats.days[getTodayStrFromDate(d)]) {
            streak++;
            d.setDate(d.getDate()-1);
        }
        document.getElementById('stat-streak').textContent = streak;
        document.getElementById('stat-best-streak').textContent = best;
        
        // Update current date display
        const currentDateElem = document.getElementById('current-date');
        if (currentDateElem) {
            currentDateElem.textContent = new Date().toLocaleDateString('en-US', { 
                weekday: 'short', 
                month: 'short', 
                day: 'numeric' 
            });
        }
        
        // Habit grid
        renderHabitGrid(stats.days || {});
        
        // Update motivation message based on streak and total rounds
        updateMotivationMessage(streak, stats.totalRounds || 0);
    }

    function getTodayStrFromDate(date) {
        return date.toISOString().slice(0,10);
    }

    function renderHabitGrid(daysObj) {
        const grid = document.getElementById('habit-grid');
        grid.innerHTML = '';
        const today = new Date();
        let d = new Date(today);
        d.setDate(d.getDate() - 41); // Show last 6 weeks (42 days)
        for (let i=0; i<42; i++) {
            const dayStr = getTodayStrFromDate(d);
            const marked = !!daysObj[dayStr];
            const cell = document.createElement('div');
            cell.className = 'w-6 h-6 rounded flex items-center justify-center text-xs font-bold cursor-pointer ' + (marked ? 'bg-orange-400 text-white' : 'bg-gray-200 text-gray-400 hover:bg-orange-100');
            cell.title = dayStr;
            cell.textContent = d.getDate();
            cell.addEventListener('click', () => {
                toggleHabitDay(dayStr);
            });
            grid.appendChild(cell);
            d.setDate(d.getDate()+1);
        }
    }

    function toggleHabitDay(dayStr) {
        const stats = loadStats();
        if (stats.days[dayStr]) {
            delete stats.days[dayStr];
        } else {
            stats.days[dayStr] = true;
        }
        saveStats(stats);
        updateStatsUI();
    }

    function recordPractice(rounds) {
        const stats = loadStats();
        stats.totalRounds = (stats.totalRounds || 0) + rounds;
        const today = getTodayStr();
        stats.days[today] = true;
        // Set today's rounds to the actual number completed from Practice page
        if (!stats.todayRounds) stats.todayRounds = {};
        stats.todayRounds[today] = rounds;
        // Update streaks
        let streak = 0;
        let d = new Date();
        while (stats.days[getTodayStrFromDate(d)]) {
            streak++;
            d.setDate(d.getDate()-1);
        }
        if (!stats.bestStreak || streak > stats.bestStreak) stats.bestStreak = streak;
        saveStats(stats);
        updateStatsUI();
        updateTodayStatsUI();
    }

    // --- Today's Stats & Habit + Button Logic ---
    function updateTodayStatsUI() {
        const stats = loadStats();
        const today = getTodayStr();
        // Count rounds completed today (if tracked)
        let todayRounds = stats.todayRounds || {};
        let rounds = todayRounds[today] || 0;
        document.getElementById('stat-today-rounds').textContent = rounds;
        
        // Update + button state - now we always allow adding rounds
        const markBtn = document.getElementById('mark-today-btn');
        if (markBtn) {
            markBtn.disabled = false;
            markBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            
    // Update the button text based on whether today is already marked
    if (stats.days[today]) {
        markBtn.innerHTML = '<i class="fas fa-plus mr-2"></i> Add Round';
    } else {
        markBtn.innerHTML = '<i class="fas fa-plus mr-2"></i> Start Today';
    }
    
    // Add event listener for the "Complete Round" button
    const completeRoundBtn = document.getElementById('complete-round-btn');
    if (completeRoundBtn) {
        completeRoundBtn.addEventListener('click', () => {
            markTodayCompleted();
        });
    }
        }
    }

    function markTodayCompleted() {
        const stats = loadStats();
        const today = getTodayStr();
        
        // Mark today in habit tracker
        stats.days[today] = true;
        
        // Increment total rounds
        stats.totalRounds = (stats.totalRounds || 0) + 1;
        
        // Increment today's rounds
        if (!stats.todayRounds) stats.todayRounds = {};
        stats.todayRounds[today] = (stats.todayRounds[today] || 0) + 1;
        
        // Update streaks
        let streak = 0;
        let d = new Date();
        while (stats.days[getTodayStrFromDate(d)]) {
            streak++;
            d.setDate(d.getDate()-1);
        }
        if (!stats.bestStreak || streak > stats.bestStreak) stats.bestStreak = streak;
        
        // Save stats and update UI
        saveStats(stats);
        updateStatsUI();
        updateTodayStatsUI();
        
        // Show a confirmation message
        const motivationElem = document.getElementById('stats-motivation');
        if (motivationElem) {
            const originalText = motivationElem.textContent;
            motivationElem.textContent = "Round added successfully! Keep up the good work!";
            motivationElem.classList.add('bg-green-100', 'text-green-700');
            
            // Restore original message after 3 seconds
            setTimeout(() => {
                motivationElem.textContent = originalText;
                motivationElem.classList.remove('bg-green-100', 'text-green-700');
            }, 3000);
        }
    }

    // Add event listeners for + buttons
    function setupTodayStatsButtons() {
        const markBtn = document.getElementById('mark-today-btn');
        if (markBtn) markBtn.onclick = markTodayCompleted;
        const habitPlusBtn = document.getElementById('habit-plus-btn');
        if (habitPlusBtn) habitPlusBtn.onclick = markTodayCompleted;
    }

    // Update motivation message based on streak and total rounds
    function updateMotivationMessage(streak, totalRounds) {
        const motivationElem = document.getElementById('stats-motivation');
        if (!motivationElem) return;
        
        let message = '';
        
        if (streak === 0) {
            message = "Start your Surya Namaskar journey today!";
        } else if (streak === 1) {
            message = "Great start! Keep the momentum going tomorrow.";
        } else if (streak < 7) {
            message = `Awesome! You've practiced for ${streak} days in a row.`;
        } else if (streak < 14) {
            message = `Impressive! A ${streak}-day streak shows real dedication.`;
        } else if (streak < 30) {
            message = `Amazing discipline! ${streak} days of consistent practice.`;
        } else {
            message = `Extraordinary! ${streak} days of practice is truly inspiring!`;
        }
        
        // Add total rounds message if applicable
        if (totalRounds > 0) {
            if (totalRounds < 50) {
                message += ` You've completed ${totalRounds} rounds so far.`;
            } else if (totalRounds < 100) {
                message += ` With ${totalRounds} total rounds, you're building strength!`;
            } else if (totalRounds < 500) {
                message += ` ${totalRounds} rounds completed - that's dedication!`;
            } else {
                message += ` ${totalRounds} rounds! You're a Surya Namaskar master!`;
            }
        }
        
        motivationElem.textContent = message;
    }
    
    // Function to handle sharing stats
    function setupShareFunctionality() {
        const shareBtn = document.getElementById('share-stats-btn');
        const closeModalBtn = document.getElementById('close-share-modal');
        const copyBtn = document.getElementById('copy-stats-btn');
        const downloadBtn = document.getElementById('download-stats-btn');
        const shareModal = document.getElementById('share-modal');
        
        if (shareBtn) {
            shareBtn.addEventListener('click', () => {
                // Update share card with current stats
                updateShareCard();
                // Show modal
                shareModal.classList.remove('hidden');
            });
        }
        
        if (closeModalBtn) {
            closeModalBtn.addEventListener('click', () => {
                shareModal.classList.add('hidden');
            });
        }
        
        if (copyBtn) {
            copyBtn.addEventListener('click', () => {
                // Create text to copy
                const stats = loadStats();
                const today = getTodayStr();
                const todayRounds = stats.todayRounds && stats.todayRounds[today] ? stats.todayRounds[today] : 0;
                const totalRounds = stats.totalRounds || 0;
                const streak = document.getElementById('stat-streak').textContent;
                
                const shareText = `🧘 My Surya Namaskar Practice 🧘\n\n` +
                                 `Today: ${todayRounds} rounds\n` +
                                 `Total: ${totalRounds} rounds\n` +
                                 `Streak: ${streak} days\n\n` +
                                 `Join me in practicing Surya Namaskar daily!`;
                
                // Copy to clipboard
                navigator.clipboard.writeText(shareText)
                    .then(() => {
                        copyBtn.innerHTML = '<i class="fas fa-check mr-2"></i> Copied!';
                        setTimeout(() => {
                            copyBtn.innerHTML = '<i class="fas fa-copy mr-2"></i> Copy Text';
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Failed to copy text: ', err);
                        copyBtn.innerHTML = '<i class="fas fa-times mr-2"></i> Failed';
                        setTimeout(() => {
                            copyBtn.innerHTML = '<i class="fas fa-copy mr-2"></i> Copy Text';
                        }, 2000);
                    });
            });
        }
        
        if (downloadBtn) {
            downloadBtn.addEventListener('click', () => {
                const shareCard = document.getElementById('share-card');
                if (!shareCard) return;
                
                alert('To save as image: Take a screenshot of this card to share on social media.');
            });
        }
    }
    
    // Update the share card with current stats
    function updateShareCard() {
        const stats = loadStats();
        const today = getTodayStr();
        const todayRounds = stats.todayRounds && stats.todayRounds[today] ? stats.todayRounds[today] : 0;
        const totalRounds = stats.totalRounds || 0;
        const streak = document.getElementById('stat-streak').textContent;
        
        // Update share card elements
        document.getElementById('share-today-rounds').textContent = todayRounds;
        document.getElementById('share-total-rounds').textContent = totalRounds;
        document.getElementById('share-streak').textContent = streak;
        document.getElementById('share-date').textContent = new Date().toLocaleDateString('en-US', { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
    }
    
    // Call updateStatsUI on tab open
    const statsTabBtn = document.querySelector('[data-tab="stats"]');
    statsTabBtn.addEventListener('click', () => {
        updateStatsUI();
        updateTodayStatsUI();
        setupTodayStatsButtons();
        setupShareFunctionality();
    });

    // --- Event Listeners ---
    tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            activateTab(btn.getAttribute('data-tab'));
        });
    });

    // Single play/pause button event listener
    playPauseBtn.addEventListener('click', togglePlayPause);
    resetBtn.addEventListener('click', resetPractice);
    saveSettingsBtn.addEventListener('click', saveSettings);
    
    // Dark mode toggle event listener
    document.getElementById('theme-toggle').addEventListener('click', toggleDarkMode);

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        registerServiceWorker();
        loadSettings(); // Load settings FIRST - this updates the poses array durations
        loadThemePreference(); // Load theme preference
        resetPractice(); // Set initial practice state using the loaded durations
        activateTab('pose-guide'); // Start on the guide tab
        addSpeedPresets(); // Add speed presets to Timing Tab
        
        // Add event listeners for user interaction to preload audio on iOS
        document.addEventListener('click', function audioSetup() {
            preloadAudioFiles();
            // Remove this listener after first interaction
            document.removeEventListener('click', audioSetup);
        }, { once: true });
    });

    // Replace moveToNextPose with moveToNextPoseWithStats
    moveToNextPose = moveToNextPoseWithStats;

    // Swipe navigation for tabs
    const tabContainer = document.getElementById('app-container'); // Or a more specific container if needed
    const tabs = document.querySelectorAll('.tab-content');
    const tabButtons = document.querySelectorAll('.tab-btn');
    let touchStartX = 0;
    let touchEndX = 0;
    let currentTabIndex = 0; // Keep track of the current tab index

    // Find initial active tab index
    tabs.forEach((tab, index) => {
        if (tab.classList.contains('active')) {
            currentTabIndex = index;
        }
    });

    tabs.forEach((tab, index) => {
        tab.addEventListener('touchstart', (e) => {
            // Ignore swipes if practice is running to avoid conflict
            if (document.getElementById('guided-practice').contains(e.target) && isPlaying) return;
            touchStartX = e.changedTouches[0].screenX;
        }, { passive: true });

        tab.addEventListener('touchend', (e) => {
            // Ignore swipes if practice is running
            if (document.getElementById('guided-practice').contains(e.target) && isPlaying) return;
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe(); // Pass the current index implicitly via global var
        }, { passive: true });
    });

    function handleSwipe() {
        const swipeThreshold = 50; // Minimum pixels to swipe
        const swipeDistance = touchEndX - touchStartX;

        if (Math.abs(swipeDistance) > swipeThreshold) {
            let nextIndex;
            if (swipeDistance < 0) {
                // Swipe Left - Go to Next Tab
                nextIndex = (currentTabIndex + 1) % tabButtons.length;
            } else {
                // Swipe Right - Go to Previous Tab
                nextIndex = (currentTabIndex - 1 + tabButtons.length) % tabButtons.length;
            }
            // Find the tab ID associated with the next index
            const nextTabId = tabButtons[nextIndex].getAttribute('data-tab');
            if (nextTabId) {
                 window.switchTab(nextTabId); // Use the wrapped switchTab
            }
        }
        // Reset touch points
        touchStartX = 0;
        touchEndX = 0;
    }

    // Wrap the original switchTab to update currentTabIndex
    const originalSwitchTab = window.switchTab;
    window.switchTab = function(tabId) {
        originalSwitchTab(tabId); // Call the original function
        // Update currentTabIndex based on the newly activated tab
        tabButtons.forEach((btn, index) => {
            if (btn.getAttribute('data-tab') === tabId) {
                currentTabIndex = index;
            }
        });
        // Ensure header visibility is correct after tab switch
        checkScrollPosition();
    };

</script>
</body>
</html>
